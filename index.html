<!--QUINIELA LuAn ¬© 2026 ¬∑ ING. LUIS L√ÅREZ ¬∑ Arichuna, Venezuela-->
<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="theme-color" content="#0d0d14">
<title>‚öΩ Quiniela LuAn</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@700;800&family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
<style>
:root {
--bg:       #0d0d14;
--surface:  #13131f;
--surface2: #1a1a2e;
--border:   rgba(255,255,255,0.07);
--border2:  rgba(255,255,255,0.12);
--primary:  #6c47ff;
--primary2: #9d7dff;
--gold:     #f5c542;
--green:    #00e5a0;
--red:      #ff4d6d;
--orange:   #ff8c42;
--blue:     #3b9eff;
--text:     #f0eeff;
--muted:    #5e5e8a;
--muted2:   #8888aa;
--font-h:   'Syne', sans-serif;
--font-b:   'DM Sans', sans-serif;
--r:        14px;
--r-sm:     10px;
--shadow:   0 8px 32px rgba(0,0,0,0.5);
}
*, *::before, *::after { margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color:transparent; }
html { scroll-behavior: smooth; }
body {
font-family: var(--font-b);
background: var(--bg);
color: var(--text);
min-height: 100vh;
overflow-x: hidden;
}
.hidden { display:none !important; }
body::before {
content:'';
position:fixed; inset:0; z-index:0; pointer-events:none;
background:
radial-gradient(ellipse 60% 40% at 20% 10%, rgba(108,71,255,0.15) 0%, transparent 60%),
radial-gradient(ellipse 40% 30% at 80% 80%, rgba(61,158,255,0.10) 0%, transparent 60%);
}
#app { position:relative; z-index:1; max-width:500px; margin:0 auto; min-height:100vh; display:flex; flex-direction:column; }
.screen { flex:1; display:flex; flex-direction:column; padding:16px; padding-bottom:90px; }
#authScreen {
min-height:100vh; display:flex; flex-direction:column;
justify-content:center; padding:24px; gap:0;
}
.auth-logo {
text-align:center; margin-bottom:40px;
}
.auth-logo-icon {
font-size:3.5em; display:block; margin-bottom:8px;
filter: drop-shadow(0 0 20px rgba(108,71,255,0.6));
}
.auth-logo h1 {
font-family:var(--font-h); font-size:2.4em; font-weight:800;
background: linear-gradient(135deg, var(--primary2), var(--blue));
-webkit-background-clip:text; -webkit-text-fill-color:transparent;
letter-spacing:2px;
}
.auth-logo p { color:var(--muted2); font-size:0.88em; margin-top:4px; }
.auth-tabs {
display:flex; background:var(--surface); border-radius:var(--r);
padding:4px; margin-bottom:24px; border:1px solid var(--border);
}
.auth-tab {
flex:1; padding:10px; text-align:center; border-radius:10px;
font-weight:700; font-size:0.85em; cursor:pointer; transition:all 0.2s;
color:var(--muted2); text-transform:uppercase; letter-spacing:1px;
}
.auth-tab.active {
background:var(--primary); color:#fff;
box-shadow:0 4px 16px rgba(108,71,255,0.4);
}
.field { margin-bottom:14px; }
.field label {
display:block; font-size:0.72em; font-weight:700;
color:var(--muted2); text-transform:uppercase; letter-spacing:1.5px; margin-bottom:6px;
}
.field input, .field select, .field textarea {
width:100%; padding:13px 16px;
background:var(--surface2); border:1px solid var(--border2);
border-radius:var(--r-sm); color:var(--text);
font-family:var(--font-b); font-size:0.95em; font-weight:500;
transition:border-color 0.2s, box-shadow 0.2s;
}
.field input:focus, .field select:focus, .field textarea:focus {
outline:none; border-color:var(--primary);
box-shadow:0 0 0 3px rgba(108,71,255,0.2);
}
.field select { cursor:pointer; }
.field textarea { resize:none; min-height:80px; }
.phone-row { display:flex; gap:8px; }
.country-btn {
padding:13px 12px; background:var(--surface2); border:1px solid var(--border2);
border-radius:var(--r-sm); color:var(--text); font-family:var(--font-b);
font-weight:700; font-size:0.88em; cursor:pointer; white-space:nowrap;
min-width:96px; transition:border-color 0.2s;
}
.country-btn:hover { border-color:var(--primary); }
.country-dropdown {
position:absolute; z-index:9999; background:var(--surface);
border:1px solid var(--border2); border-radius:var(--r);
width:280px; max-height:300px; overflow-y:auto;
box-shadow:var(--shadow); margin-top:4px;
}
.country-search {
width:100%; padding:12px 16px; background:var(--surface2);
border:none; border-bottom:1px solid var(--border); color:var(--text);
font-family:var(--font-b); font-weight:600;
}
.country-search:focus { outline:none; }
.country-option {
padding:10px 16px; cursor:pointer; font-size:0.88em;
font-weight:600; display:flex; align-items:center; gap:10px;
transition:background 0.15s;
}
.country-option:hover { background:var(--surface2); }
.country-option .dial { color:var(--primary2); font-weight:800; min-width:44px; }
.btn {
display:block; width:100%; padding:14px 20px;
border:none; border-radius:var(--r-sm);
font-family:var(--font-b); font-weight:700; font-size:0.92em;
cursor:pointer; transition:all 0.2s; text-transform:uppercase;
letter-spacing:1px; text-align:center;
}
.btn:disabled { opacity:0.4; cursor:not-allowed; transform:none !important; }
.btn:active { transform:scale(0.98); }
.btn-primary {
background:linear-gradient(135deg, var(--primary), var(--primary2));
color:#fff; box-shadow:0 4px 20px rgba(108,71,255,0.4);
}
.btn-primary:hover { box-shadow:0 6px 28px rgba(108,71,255,0.6); transform:translateY(-1px); }
.btn-green { background:linear-gradient(135deg,#00b37a,var(--green)); color:#000; }
.btn-red { background:linear-gradient(135deg,#cc2244,var(--red)); color:#fff; }
.btn-ghost {
background:transparent; color:var(--muted2);
border:1px solid var(--border2);
}
.btn-ghost:hover { border-color:var(--primary2); color:var(--primary2); }
.btn-sm { width:auto; display:inline-block; padding:8px 14px; font-size:0.78em; }
.btn-wa {
background:rgba(37,211,102,0.15); border:1px solid #25d366;
color:#25d366; border-radius:var(--r-sm);
font-family:var(--font-b); font-weight:700; font-size:0.8em;
padding:9px 14px; cursor:pointer; transition:all 0.2s;
}
.btn-wa:hover { background:rgba(37,211,102,0.25); }
.header {
display:flex; align-items:center; justify-content:space-between;
padding:12px 16px; position:sticky; top:0; z-index:100;
background:rgba(13,13,20,0.85); backdrop-filter:blur(16px);
border-bottom:1px solid var(--border);
}
.header-left { display:flex; flex-direction:column; gap:2px; }
.header-greeting {
font-size:0.68em; color:var(--muted2); font-weight:600; text-transform:uppercase; letter-spacing:1px;
}
.header-name {
font-family:var(--font-h); font-size:1.1em; font-weight:800;
color:var(--text); display:flex; align-items:center; gap:6px;
}
.header-badge {
font-size:0.65em; background:var(--primary); color:#fff;
padding:2px 7px; border-radius:20px; font-family:var(--font-b); font-weight:700;
}
.header-info { display:flex; flex-direction:column; align-items:flex-end; gap:2px; }
.header-clock { font-family:var(--font-h); font-size:0.95em; color:var(--primary2); }
.header-inv { font-size:0.68em; color:var(--muted); }
.header-logout {
background:none; border:none; color:var(--muted); cursor:pointer;
font-size:1.2em; padding:6px; border-radius:8px; transition:color 0.2s;
}
.header-logout:hover { color:var(--red); }
.nav {
position:fixed; bottom:0; left:50%; transform:translateX(-50%);
width:100%; max-width:500px; z-index:200;
background:rgba(13,13,20,0.92); backdrop-filter:blur(20px);
border-top:1px solid var(--border);
display:flex; align-items:center;
padding:6px 4px env(safe-area-inset-bottom, 6px);
}
.nav-item {
flex:1; display:flex; flex-direction:column; align-items:center;
gap:3px; padding:6px 2px; cursor:pointer; border-radius:10px;
transition:all 0.2s; color:var(--muted); border:none; background:none;
}
.nav-item .nav-icon { font-size:1.3em; transition:transform 0.2s; }
.nav-item .nav-label { font-size:0.6em; font-weight:700; text-transform:uppercase; letter-spacing:0.5px; }
.nav-item.active { color:var(--primary2); }
.nav-item.active .nav-icon { transform:scale(1.15); }
.nav-item:hover { color:var(--primary2); }
#toastContainer {
position:fixed; top:70px; left:50%; transform:translateX(-50%);
z-index:9000; display:flex; flex-direction:column; gap:8px;
align-items:center; width:90%; max-width:440px; pointer-events:none;
}
.toast {
padding:12px 18px; border-radius:var(--r-sm); font-weight:700;
font-size:0.85em; box-shadow:var(--shadow); pointer-events:auto;
animation:slideDown 0.3s ease; border-left:3px solid;
background:var(--surface); max-width:100%;
}
@keyframes slideDown { from{opacity:0;transform:translateY(-12px)} to{opacity:1;transform:translateY(0)} }
.toast-success { border-color:var(--green); color:var(--green); }
.toast-error   { border-color:var(--red); color:var(--red); }
.toast-info    { border-color:var(--blue); color:var(--blue); }
.toast-warning { border-color:var(--orange); color:var(--orange); }
.modal-overlay {
position:fixed; inset:0; z-index:5000;
background:rgba(0,0,0,0.7); backdrop-filter:blur(4px);
display:flex; align-items:flex-end; justify-content:center;
}
.modal-box {
background:var(--surface); border-radius:24px 24px 0 0;
width:100%; max-width:500px; padding:24px;
max-height:90vh; overflow-y:auto;
border-top:1px solid var(--border2);
animation:slideUp 0.3s ease;
}
@keyframes slideUp { from{transform:translateY(60px);opacity:0} to{transform:translateY(0);opacity:1} }
.modal-handle {
width:40px; height:4px; background:var(--border2);
border-radius:2px; margin:0 auto 20px;
}
.modal-title {
font-family:var(--font-h); font-size:1.4em; font-weight:800;
margin-bottom:16px; color:var(--text);
}
.card {
background:var(--surface); border:1px solid var(--border);
border-radius:var(--r); padding:16px; margin-bottom:10px;
}
.card-glow {
background:linear-gradient(135deg,rgba(108,71,255,0.12),rgba(61,158,255,0.06));
border:1px solid rgba(108,71,255,0.3);
border-radius:var(--r); padding:16px; margin-bottom:10px;
}
.match-card {
background:var(--surface); border:1px solid var(--border);
border-radius:var(--r); padding:14px; margin-bottom:10px;
transition:border-color 0.2s;
}
.match-card.live {
border-color:rgba(255,77,109,0.5);
background:linear-gradient(135deg,rgba(255,77,109,0.06),var(--surface));
}
.match-card.finished {
border-color:rgba(0,229,160,0.3);
background:linear-gradient(135deg,rgba(0,229,160,0.04),var(--surface));
}
.match-meta {
display:flex; justify-content:space-between; align-items:center;
margin-bottom:10px; font-size:0.7em; font-weight:700;
color:var(--muted); text-transform:uppercase; letter-spacing:0.8px;
}
.badge-live {
background:rgba(255,77,109,0.2); color:var(--red);
padding:3px 10px; border-radius:20px; border:1px solid rgba(255,77,109,0.3);
font-size:0.85em; animation:pulse 2s infinite;
}
@keyframes pulse { 0%,100%{opacity:1} 50%{opacity:0.6} }
.badge-done { background:rgba(0,229,160,0.15); color:var(--green); padding:3px 10px; border-radius:20px; }
.badge-time { color:var(--primary2); font-family:var(--font-h); font-size:1em; }
.match-teams {
display:grid; grid-template-columns:1fr auto 1fr;
align-items:center; gap:8px; margin-bottom:10px;
}
.team { text-align:center; }
.team-flag { font-size:2em; display:block; margin-bottom:4px; }
.team-name { font-size:0.68em; font-weight:700; color:var(--muted2); text-transform:uppercase; letter-spacing:0.5px; }
.team-score { font-family:var(--font-h); font-size:2.2em; font-weight:800; }
.score-live { color:var(--red); }
.score-final { color:var(--green); }
.vs-divider { font-family:var(--font-h); font-size:1.4em; color:var(--muted); text-align:center; }
.pred-row { display:flex; align-items:center; justify-content:center; gap:12px; }
.pred-input {
width:56px; height:56px; text-align:center;
background:var(--surface2); border:2px solid var(--border2);
border-radius:12px; color:var(--text);
font-family:var(--font-h); font-size:1.6em; font-weight:800;
transition:border-color 0.2s, box-shadow 0.2s;
}
.pred-input:focus {
outline:none; border-color:var(--primary);
box-shadow:0 0 0 3px rgba(108,71,255,0.2);
}
.pred-dash { font-family:var(--font-h); font-size:1.4em; color:var(--muted); }
.goal-list { margin-top:8px; padding-top:8px; border-top:1px solid var(--border); }
.goal-item {
display:flex; align-items:center; gap:6px;
font-size:0.75em; color:var(--muted2); padding:3px 0; font-weight:600;
}
.goal-home { color:var(--text); }
.goal-away { color:var(--blue); }
.stats-btn {
width:100%; padding:9px; margin-top:8px;
background:rgba(108,71,255,0.15); border:1px solid rgba(108,71,255,0.3);
border-radius:var(--r-sm); color:var(--primary2);
font-family:var(--font-b); font-weight:700; font-size:0.78em;
cursor:pointer; transition:all 0.2s; text-transform:uppercase; letter-spacing:1px;
}
.stats-btn:hover { background:rgba(108,71,255,0.25); }
.rank-row {
display:flex; align-items:center; gap:12px;
padding:12px; border-radius:var(--r-sm); margin-bottom:6px;
background:var(--surface2); border:1px solid var(--border);
transition:border-color 0.2s;
}
.rank-row.me { border-color:var(--primary); background:rgba(108,71,255,0.1); }
.rank-row:first-child { border-color:var(--gold); background:rgba(245,197,66,0.07); }
.rank-pos { font-family:var(--font-h); font-size:1.2em; min-width:32px; text-align:center; }
.rank-name { flex:1; font-weight:700; font-size:0.9em; }
.rank-sub { font-size:0.7em; color:var(--muted2); font-weight:500; margin-top:2px; }
.rank-pts { font-family:var(--font-h); font-size:1.4em; color:var(--primary2); }
.pred-item {
display:grid; grid-template-columns:1fr auto auto auto;
align-items:center; gap:10px;
padding:12px; border-radius:var(--r-sm); margin-bottom:6px;
background:var(--surface2); border:1px solid var(--border);
}
.pred-match-name { font-weight:700; font-size:0.82em; }
.pred-match-sub { font-size:0.7em; color:var(--muted2); }
.pred-score-box {
font-family:var(--font-h); font-size:1.2em; font-weight:800;
background:rgba(108,71,255,0.15); padding:4px 10px;
border-radius:8px; color:var(--primary2);
}
.pred-real-box { font-size:0.75em; text-align:center; color:var(--muted2); }
.pred-real-score { font-family:var(--font-h); font-size:1.1em; color:var(--green); display:block; }
.pred-pts-box {
font-weight:800; font-size:0.85em; padding:4px 10px;
border-radius:8px; text-align:center;
}
.pts-5 { background:rgba(0,229,160,0.2); color:var(--green); }
.pts-3 { background:rgba(59,158,255,0.2); color:var(--blue); }
.pts-0 { background:rgba(255,77,109,0.15); color:var(--red); }
.pts-pending { background:rgba(245,197,66,0.15); color:var(--gold); }
#screenChat {
padding:0 !important;
padding-bottom:0 !important;
flex-direction:column;
height:calc(100svh - 120px);
position:relative;
background:var(--bg);
display:flex;
}
.chat-header {
padding:16px; border-bottom:1px solid var(--border);
display:flex; align-items:center; gap:12px;
background:rgba(13,13,20,0.9); backdrop-filter:blur(16px);
position:sticky; top:0; z-index:10;
}
.chat-header-info h3 { font-family:var(--font-h); font-size:1.1em; }
.chat-header-info p { font-size:0.72em; color:var(--muted2); }
.chat-online { width:8px; height:8px; border-radius:50%; background:var(--green); animation:pulse 2s infinite; }
.chat-messages {
flex:1;
overflow-y:auto;
padding:12px 16px 80px;
display:flex;
flex-direction:column;
gap:8px;
-webkit-overflow-scrolling:touch;
overscroll-behavior:contain;
}
.chat-msg { max-width:80%; display:flex; flex-direction:column; gap:3px; }
.chat-msg.mine { align-self:flex-end; align-items:flex-end; }
.chat-msg.theirs { align-self:flex-start; align-items:flex-start; }
.chat-bubble {
padding:10px 14px; border-radius:18px;
font-size:0.88em; font-weight:500; line-height:1.5;
position:relative; word-break:break-word;
}
.chat-msg.mine .chat-bubble {
background:linear-gradient(135deg,var(--primary),var(--primary2));
color:#fff; border-bottom-right-radius:4px;
}
.chat-msg.theirs .chat-bubble {
background:var(--surface2); color:var(--text);
border:1px solid var(--border2); border-bottom-left-radius:4px;
}
.chat-name { font-size:0.68em; font-weight:700; margin-bottom:2px; padding-left:4px; }
.chat-time { font-size:0.65em; color:var(--muted); padding:0 4px; }
.chat-input-bar {
position:sticky;
bottom:60px;
width:100%;
padding:10px 16px;
background:rgba(13,13,20,0.97);
backdrop-filter:blur(20px);
border-top:1px solid var(--border);
display:flex;
gap:8px;
align-items:flex-end;
z-index:10;
flex-shrink:0;
}
.chat-input {
flex:1; padding:11px 16px; background:var(--surface2);
border:1px solid var(--border2); border-radius:22px;
color:var(--text); font-family:var(--font-b); font-size:0.9em;
resize:none; max-height:100px; font-weight:500;
}
.chat-input:focus { outline:none; border-color:var(--primary); }
.chat-send {
width:42px; height:42px; border-radius:50%;
background:linear-gradient(135deg,var(--primary),var(--primary2));
border:none; color:#fff; font-size:1.1em; cursor:pointer;
display:flex; align-items:center; justify-content:center;
flex-shrink:0; transition:transform 0.2s, box-shadow 0.2s;
}
.chat-send:hover { transform:scale(1.08); box-shadow:0 4px 16px rgba(108,71,255,0.5); }
.chat-system {
text-align:center; font-size:0.72em; color:var(--muted);
padding:4px 12px; background:var(--surface2); border-radius:20px;
align-self:center; font-weight:600;
}
.tourn-item {
display:flex; align-items:center; justify-content:space-between;
padding:14px 16px; border-radius:var(--r-sm); margin-bottom:8px;
background:var(--surface2); border:1px solid var(--border);
cursor:pointer; transition:all 0.2s;
}
.tourn-item.selected { border-color:var(--primary); background:rgba(108,71,255,0.1); }
.tourn-item:hover { border-color:var(--border2); }
.tourn-left { display:flex; align-items:center; gap:12px; font-weight:700; font-size:0.9em; }
.tourn-check {
width:22px; height:22px; border-radius:6px; border:2px solid var(--border2);
display:flex; align-items:center; justify-content:center;
font-size:0.8em; transition:all 0.2s;
}
.tourn-item.selected .tourn-check { background:var(--primary); border-color:var(--primary); }
.group-card {
background:var(--surface); border:1px solid var(--border);
border-radius:var(--r); padding:16px; margin-bottom:10px;
}
.group-card-header {
display:flex; justify-content:space-between; align-items:flex-start; margin-bottom:10px;
}
.group-name { font-family:var(--font-h); font-size:1.1em; font-weight:800; }
.group-code {
background:var(--surface2); border:1px solid var(--border2);
border-radius:8px; padding:4px 10px; text-align:center;
}
.group-code-label { font-size:0.6em; color:var(--muted); font-weight:700; text-transform:uppercase; letter-spacing:1px; display:block; }
.group-code-val { font-family:var(--font-h); font-size:1.2em; color:var(--primary2); letter-spacing:3px; }
.group-meta { font-size:0.75em; color:var(--muted2); margin-bottom:12px; }
.group-actions { display:flex; gap:8px; }
.btn-del {
padding:8px 12px; background:rgba(255,77,109,0.15); border:1px solid rgba(255,77,109,0.3);
color:var(--red); border-radius:var(--r-sm); font-family:var(--font-b);
font-weight:700; font-size:0.75em; cursor:pointer; transition:all 0.2s;
}
.btn-del:hover { background:rgba(255,77,109,0.25); }
.btn-rank {
flex:1; padding:9px; background:rgba(108,71,255,0.15); border:1px solid rgba(108,71,255,0.3);
color:var(--primary2); border-radius:var(--r-sm); font-family:var(--font-b);
font-weight:700; font-size:0.78em; cursor:pointer; transition:all 0.2s; text-align:center;
}
.btn-rank:hover { background:rgba(108,71,255,0.25); }
.admin-grid {
display:grid; grid-template-columns:1fr 1fr; gap:8px; margin-bottom:16px;
}
.admin-btn {
padding:16px 12px; background:var(--surface2);
border:1px solid var(--border2); border-radius:var(--r-sm);
color:var(--text); font-family:var(--font-b); font-weight:700;
font-size:0.82em; cursor:pointer; transition:all 0.2s;
text-align:center; line-height:1.4;
}
.admin-btn:hover { border-color:var(--primary2); color:var(--primary2); background:rgba(108,71,255,0.08); }
.admin-btn.full { grid-column:span 2; }
.admin-btn.accent { border-color:var(--primary2); color:var(--primary2); }
.admin-btn.warn { border-color:var(--orange); color:var(--orange); }
.admin-btn.danger { border-color:var(--red); color:var(--red); }
.admin-output {
background:var(--surface2); border:1px solid var(--border);
border-radius:var(--r); padding:14px; min-height:60px;
font-size:0.85em;
}
.countdown-banner {
background:rgba(245,197,66,0.12); border:1px solid rgba(245,197,66,0.3);
border-radius:var(--r-sm); padding:10px 14px; margin-bottom:12px;
display:flex; justify-content:space-between; align-items:center;
font-size:0.8em;
}
.countdown-label { color:var(--gold); font-weight:700; }
.countdown-match { color:var(--muted2); }
.countdown-status { color:var(--red); font-weight:800; font-size:0.9em; }
.section-header {
display:flex; justify-content:space-between; align-items:center;
margin-bottom:14px; padding-bottom:10px; border-bottom:1px solid var(--border);
}
.section-title { font-family:var(--font-h); font-size:1.2em; font-weight:800; }
.section-sub { font-size:0.75em; color:var(--muted2); }
.code-input {
font-family:var(--font-h); font-size:2em; font-weight:800;
text-align:center; letter-spacing:8px; text-transform:uppercase;
padding:16px; background:var(--surface2); border:2px solid var(--border2);
border-radius:var(--r-sm); color:var(--primary2); width:100%;
transition:border-color 0.2s;
}
.code-input:focus { outline:none; border-color:var(--primary); box-shadow:0 0 0 3px rgba(108,71,255,0.2); }
.join-status { min-height:44px; margin:10px 0; }
.status-box {
padding:10px 14px; border-radius:var(--r-sm);
font-weight:700; font-size:0.85em; border-left:3px solid;
}
.status-success { background:rgba(0,229,160,0.1); border-color:var(--green); color:var(--green); }
.status-error { background:rgba(255,77,109,0.1); border-color:var(--red); color:var(--red); }
.status-info { background:rgba(59,158,255,0.1); border-color:var(--blue); color:var(--blue); }
.player-num {
font-size:0.62em; color:var(--muted); font-weight:700;
background:var(--surface2); padding:2px 7px; border-radius:10px;
border:1px solid var(--border);
}
.empty {
text-align:center; padding:40px 20px; color:var(--muted);
}
.empty-icon { font-size:2.5em; display:block; margin-bottom:10px; }
.empty-text { font-weight:600; font-size:0.9em; }
.divider { border:none; border-top:1px solid var(--border); margin:14px 0; }
.big-stat {
text-align:center; padding:16px 0;
}
.big-stat-num { font-family:var(--font-h); font-size:3em; color:var(--primary2); display:block; }
.big-stat-label { font-size:0.78em; color:var(--muted2); font-weight:700; text-transform:uppercase; letter-spacing:1px; }
.info-row {
display:flex; justify-content:space-between; align-items:center;
padding:8px 0; border-bottom:1px solid var(--border); font-size:0.85em;
}
.info-row:last-child { border:none; }
.sim-match-card {
background:var(--surface2); border:1px solid var(--border);
border-radius:var(--r); padding:14px; margin-bottom:10px;
}
.sim-score-row {
display:flex; align-items:center; justify-content:center; gap:12px; margin-top:10px;
}
.sim-input {
width:60px; height:60px; text-align:center;
background:rgba(108,71,255,0.15); border:2px solid var(--primary);
border-radius:12px; color:var(--primary2);
font-family:var(--font-h); font-size:1.8em; font-weight:800;
transition:all 0.2s;
}
.sim-input:focus { outline:none; border-color:var(--gold); color:var(--gold); box-shadow:0 0 0 3px rgba(245,197,66,0.2); }
.scenario-chip {
display:inline-block; padding:6px 12px; border-radius:20px;
background:var(--surface2); border:1px solid var(--border2);
font-size:0.78em; font-weight:700; cursor:pointer; transition:all 0.2s;
color:var(--muted2);
}
.scenario-chip:hover { border-color:var(--primary2); color:var(--primary2); }
.sim-result-row {
display:flex; align-items:center; gap:10px;
padding:10px 12px; border-radius:var(--r-sm); margin-bottom:6px;
background:var(--surface2); border:1px solid var(--border);
}
.sim-result-row.me { background:rgba(245,197,66,0.1); border-color:rgba(245,197,66,0.4); }
.sim-result-row.leader { background:rgba(0,229,160,0.07); border-color:rgba(0,229,160,0.3); }
.sim-pos { font-family:var(--font-h); font-size:1.2em; min-width:36px; text-align:center; }
.sim-name { flex:1; font-weight:700; font-size:0.88em; }
.sim-pts { font-family:var(--font-h); font-size:1.3em; color:var(--primary2); }
.sim-gain { font-size:0.72em; color:var(--green); font-weight:700; }
.sim-change { font-size:0.8em; font-weight:800; min-width:36px; text-align:center; }
.sim-analysis {
background:rgba(108,71,255,0.08); border:1px solid rgba(108,71,255,0.25);
border-radius:var(--r); padding:16px; margin-top:14px;
}
.info-label { color:var(--muted2); font-weight:600; }
.info-val { font-weight:700; }
.locked-box {
text-align:center; padding:20px;
background:rgba(245,197,66,0.07); border-radius:var(--r-sm);
border:1px solid rgba(245,197,66,0.2); margin-bottom:14px;
}
.locked-box .lock-icon { font-size:2em; display:block; margin-bottom:8px; }
.locked-box p { color:var(--gold); font-weight:700; font-size:0.85em; }
.locked-box small { color:var(--muted2); font-size:0.78em; }
</style>
</head>
<body>
<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê TOAST CONTAINER ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="toastContainer"></div>
<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê AUTH SCREEN ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="authScreen">
<div class="auth-logo">
<span class="auth-logo-icon">‚öΩ</span>
<h1>QUINIELA LuAn</h1>
<p>La quiniela de los campeones</p>
</div>
<div class="auth-tabs">
<div class="auth-tab active" id="tabLogin" onclick="switchAuthTab('login')">Entrar</div>
<div class="auth-tab" id="tabReg" onclick="switchAuthTab('register')">Registrarse</div>
</div>
<!-- LOGIN -->
<div id="formLogin">
<div class="field">
<label>Tel√©fono</label>
<div class="phone-row" style="position:relative;">
<button type="button" class="country-btn" id="loginCountryBtn" onclick="openCountryPicker('login')">üáªüá™ +58 ‚ñæ</button>
<input type="tel" id="loginPhone" placeholder="4141234567" style="flex:1;" onkeydown="if(event.key==='Enter')doLogin()">
</div>
</div>
<div class="field">
<label>Contrase√±a</label>
<input type="password" id="loginPass" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" onkeydown="if(event.key==='Enter')doLogin()">
</div>
<button class="btn btn-primary" onclick="doLogin()">Entrar ‚Üí</button>
<button class="btn btn-ghost" style="margin-top:8px;" onclick="showReset()">¬øOlvidaste tu contrase√±a?</button>
</div>
<!-- REGISTER -->
<div id="formRegister" class="hidden">
<div class="field">
<label>Nombre completo</label>
<input type="text" id="regName" placeholder="Tu nombre">
</div>
<div class="field">
<label>Apodo (m√°x. 8 caracteres)</label>
<input type="text" id="regUsername" placeholder="LUISLA" maxlength="8" style="text-transform:uppercase;" oninput="this.value=this.value.toUpperCase()">
</div>
<div class="field">
<label>Tel√©fono</label>
<div class="phone-row" style="position:relative;">
<button type="button" class="country-btn" id="regCountryBtn" onclick="openCountryPicker('reg')">üáªüá™ +58 ‚ñæ</button>
<input type="tel" id="regPhone" placeholder="4141234567" style="flex:1;">
</div>
</div>
<div class="field">
<label>Contrase√±a</label>
<input type="password" id="regPass" placeholder="M√≠nimo 6 caracteres">
</div>
<div class="field">
<label>C√≥digo de invitaci√≥n (opcional)</label>
<input type="text" id="regInvite" placeholder="ABC123" style="text-transform:uppercase;" oninput="this.value=this.value.toUpperCase()">
</div>
<button class="btn btn-primary" onclick="doRegister()">Crear cuenta ‚Üí</button>
</div>
<!-- RESET -->
<div id="formReset" class="hidden">
<p style="color:var(--muted2);font-size:0.85em;margin-bottom:16px;">Ingresa tu tel√©fono y te enviaremos un enlace para restablecer tu contrase√±a.</p>
<div class="field">
<label>Tel√©fono</label>
<div class="phone-row" style="position:relative;">
<button type="button" class="country-btn" id="resetCountryBtn" onclick="openCountryPicker('reset')">üáªüá™ +58 ‚ñæ</button>
<input type="tel" id="resetPhone" placeholder="4141234567" style="flex:1;">
</div>
</div>
<button class="btn btn-primary" onclick="doReset()">Enviar enlace</button>
<button class="btn btn-ghost" style="margin-top:8px;" onclick="switchAuthTab('login')">‚Üê Volver</button>
</div>
</div>
<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê MAIN APP ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="mainApp" class="hidden">
<!-- HEADER -->
<div class="header">
<div class="header-left">
<span class="header-greeting">Bienvenido</span>
<div class="header-name">
<span id="hdrPlayerNum" class="player-num"></span>
<span id="hdrName">‚Äî</span>
<span id="hdrAdminBadge" class="header-badge hidden">üëë Admin</span>
</div>
<div style="font-size:0.68em;color:var(--muted);">Invitaci√≥n: <strong id="hdrCode" style="color:var(--primary2);">‚Äî</strong></div>
</div>
<div class="header-info">
<div class="header-clock" id="hdrClock">--:--</div>
<div style="font-size:0.65em;color:var(--muted);">Venezuela</div>
<div style="display:flex;gap:6px;align-items:center;">
<button class="header-logout" onclick="inviteToApp()" title="Invitar amigos" style="font-size:1em;">üì≤</button>
<button class="header-logout" onclick="openModal('changePassModal')" title="Cambiar contrase√±a" style="font-size:1em;">üîë</button>
<button class="header-logout" onclick="doLogout()" title="Salir">üö™</button>
</div>
</div>
</div>
<!-- SCREENS -->
<div id="screenMatches" class="screen"></div>
<div id="screenPreds" class="screen hidden"></div>
<div id="screenChat" class="screen hidden" style="padding:0;padding-bottom:0;"></div>
<div id="screenTournaments" class="screen hidden"></div>
<div id="screenGroups" class="screen hidden"></div>
<div id="screenSimulator" class="screen hidden"></div>
<div id="screenAdmin" class="screen hidden"></div>
<div id="screenChangePass" class="screen hidden"></div>
<!-- BOTTOM NAV -->
<nav class="nav">
<button class="nav-item active" id="nav-matches" onclick="showScreen('matches')">
<span class="nav-icon">‚öΩ</span><span class="nav-label">Partidos</span>
</button>
<button class="nav-item" id="nav-preds" onclick="showScreen('preds')">
<span class="nav-icon">üéØ</span><span class="nav-label">Predecir</span>
</button>
<button class="nav-item" id="nav-chat" onclick="showScreen('chat')">
<span class="nav-icon">üí¨</span><span class="nav-label">Chat</span>
</button>
<button class="nav-item" id="nav-tournaments" onclick="showScreen('tournaments')">
<span class="nav-icon">üèÜ</span><span class="nav-label">Torneos</span>
</button>
<button class="nav-item" id="nav-groups" onclick="showScreen('groups')">
<span class="nav-icon">üë•</span><span class="nav-label">Grupos</span>
</button>
<button class="nav-item" id="nav-simulator" onclick="showScreen('simulator')">
<span class="nav-icon">üéÆ</span><span class="nav-label">Simular</span>
</button>
<button class="nav-item hidden" id="nav-admin" onclick="showScreen('admin')">
<span class="nav-icon">‚öôÔ∏è</span><span class="nav-label">Admin</span>
</button>
</nav>
</div>
<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê MODALS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<!-- Country Picker -->
<div class="modal-overlay hidden" id="countryModal" onclick="closeCountryPicker(event)">
<div class="modal-box" onclick="e=>e.stopPropagation()">
<div class="modal-handle"></div>
<div class="modal-title">üåç Pa√≠s</div>
<div class="field"><input type="text" id="countrySearch" placeholder="Buscar pa√≠s..." oninput="filterCountries(this.value)" class="field input"></div>
<div id="countryList" style="max-height:280px;overflow-y:auto;"></div>
</div>
</div>
<!-- Join Group -->
<div class="modal-overlay hidden" id="joinModal">
<div class="modal-box">
<div class="modal-handle"></div>
<div class="modal-title">üîó Unirse a Grupo</div>
<p style="color:var(--muted2);font-size:0.85em;margin-bottom:16px;">Escribe el c√≥digo de 6 letras que te comparti√≥ el admin</p>
<div class="field">
<label>C√≥digo del grupo</label>
<input type="text" id="joinCode" class="code-input" maxlength="6" oninput="this.value=this.value.toUpperCase();document.getElementById('joinStatus').innerHTML=''">
</div>
<div class="join-status" id="joinStatus"></div>
<button class="btn btn-primary" id="joinBtn" onclick="doJoinGroup()">‚úÖ Unirse al Grupo</button>
<button class="btn btn-ghost" style="margin-top:8px;" onclick="closeModal('joinModal')">Cancelar</button>
</div>
</div>
<!-- Create Group -->
<div class="modal-overlay hidden" id="createModal">
<div class="modal-box">
<div class="modal-handle"></div>
<div class="modal-title">‚ûï Crear Grupo</div>
<div class="field">
<label>Nombre del grupo</label>
<input type="text" id="createName" placeholder="Ej: Champions Squad">
</div>
<div class="field">
<label>M√°ximo de jugadores</label>
<select id="createMax">
<option value="10">10</option>
<option value="20">20</option>
<option value="50" selected>50</option>
<option value="100">100</option>
</select>
</div>
<button class="btn btn-primary" id="createBtn" onclick="doCreateGroup()">üéâ Crear Grupo</button>
<button class="btn btn-ghost" style="margin-top:8px;" onclick="closeModal('createModal')">Cancelar</button>
</div>
</div>
<!-- Group Selector (for predictions) -->
<div class="modal-overlay hidden" id="grpPickModal">
<div class="modal-box">
<div class="modal-handle"></div>
<div class="modal-title">üë• ¬øPara qu√© grupo?</div>
<p style="color:var(--muted2);font-size:0.85em;margin-bottom:16px;">Est√°s en varios grupos. Elige para cu√°l predices esta jornada.</p>
<div id="grpPickList"></div>
<button class="btn btn-ghost" style="margin-top:8px;" onclick="closeModal('grpPickModal')">Cancelar</button>
</div>
</div>
<!-- Group Ranking -->
<div class="modal-overlay hidden" id="rankModal">
<div class="modal-box">
<div class="modal-handle"></div>
<div id="rankModalTitle" class="modal-title"></div>
<div id="rankModalCode" style="font-size:0.78em;color:var(--muted2);margin-bottom:16px;"></div>
<div id="rankModalList"></div>
<button class="btn btn-green" style="margin-top:12px;width:100%;" id="sharePizarraBtn" onclick="sharePizarra()">üì≤ Compartir Pizarra por WhatsApp</button>
<button class="btn btn-ghost" style="margin-top:8px;" onclick="closeModal('rankModal')">Cerrar</button>
</div>
</div>
<!-- Change Password Modal -->
<div class="modal-overlay hidden" id="changePassModal">
<div class="modal-box">
<div class="modal-handle"></div>
<div class="modal-title">üîë Cambiar Contrase√±a</div>
<div class="field">
<label>Contrase√±a actual</label>
<input type="password" id="cpOld" placeholder="Tu contrase√±a actual">
</div>
<div class="field">
<label>Nueva contrase√±a</label>
<input type="password" id="cpNew" placeholder="M√≠nimo 6 caracteres">
</div>
<div class="field">
<label>Confirmar nueva contrase√±a</label>
<input type="password" id="cpNew2" placeholder="Repite la nueva contrase√±a">
</div>
<button class="btn btn-primary" onclick="doChangePass()">üîë Cambiar Contrase√±a</button>
<button class="btn btn-ghost" style="margin-top:8px;" onclick="closeModal('changePassModal')">Cancelar</button>
</div>
</div>
<!-- Mundial Predictions Modal -->
<div class="modal-overlay hidden" id="mundialModal">
<div class="modal-box" style="max-height:95vh;">
<div class="modal-handle"></div>
<div class="modal-title">üåçüèÜ Predicciones Mundial 2026</div>
<p style="color:var(--muted2);font-size:0.82em;margin-bottom:16px;line-height:1.6;">
Estas predicciones se hacen <strong style="color:var(--gold);">una sola vez</strong> y se bloquean al inicio del torneo.
</p>
<div id="mundialFormContent">
<!-- Puntos config (solo admin) -->
<div id="mundialAdminConfig" class="hidden">
<div style="background:rgba(108,71,255,0.1);border:1px solid rgba(108,71,255,0.3);border-radius:var(--r-sm);padding:12px;margin-bottom:14px;">
<div style="font-weight:800;font-size:0.82em;color:var(--primary2);margin-bottom:10px;">‚öôÔ∏è CONFIGURAR PUNTOS (Admin)</div>
<div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;">
<div class="field" style="margin:0;">
<label>ü•á Campe√≥n (pts)</label>
<select id="mPtsCampeon" style="width:100%;padding:10px;background:var(--surface2);border:1px solid var(--border2);border-radius:8px;color:var(--text);font-family:var(--font-b);">
<option value="5">5 pts</option><option value="6">6 pts</option>
<option value="7">7 pts</option><option value="8" selected>8 pts</option>
<option value="9">9 pts</option><option value="10">10 pts</option>
</select>
</div>
<div class="field" style="margin:0;">
<label>ü•à Subcampe√≥n (pts)</label>
<select id="mPtsSub" style="width:100%;padding:10px;background:var(--surface2);border:1px solid var(--border2);border-radius:8px;color:var(--text);font-family:var(--font-b);">
<option value="4">4 pts</option><option value="5">5 pts</option>
<option value="6" selected>6 pts</option><option value="7">7 pts</option>
<option value="8">8 pts</option>
</select>
</div>
<div class="field" style="margin:0;">
<label>ü•â Tercer Lugar (pts)</label>
<select id="mPtsTercero" style="width:100%;padding:10px;background:var(--surface2);border:1px solid var(--border2);border-radius:8px;color:var(--text);font-family:var(--font-b);">
<option value="1">1 pt</option><option value="2">2 pts</option>
<option value="3" selected>3 pts</option><option value="4">4 pts</option>
<option value="5">5 pts</option>
</select>
</div>
<div class="field" style="margin:0;">
<label>‚öΩ Goleador (pts)</label>
<select id="mPtsGoleador" style="width:100%;padding:10px;background:var(--surface2);border:1px solid var(--border2);border-radius:8px;color:var(--text);font-family:var(--font-b);">
<option value="1">1 pt</option><option value="3">3 pts</option>
<option value="5" selected>5 pts</option><option value="7">7 pts</option>
<option value="10">10 pts</option>
</select>
</div>
</div>
<button class="btn btn-primary" style="margin-top:12px;" onclick="saveMundialConfig()">üíæ Guardar Configuraci√≥n</button>
</div>
</div>
<!-- Player predictions -->
<div id="mundialPredForm">
<div class="field">
<label>ü•á ¬øQui√©n ser√° el Campe√≥n?</label>
<select id="mCampeon" style="width:100%;padding:13px;background:var(--surface2);border:1px solid var(--border2);border-radius:var(--r-sm);color:var(--text);font-family:var(--font-b);font-size:0.9em;">
<option value="">Selecciona una selecci√≥n...</option>
</select>
<div id="mPtsCampeonLabel" style="font-size:0.75em;color:var(--gold);margin-top:4px;font-weight:700;"></div>
</div>
<div class="field">
<label>ü•à ¬øQui√©n ser√° el Subcampe√≥n?</label>
<select id="mSubcampeon" style="width:100%;padding:13px;background:var(--surface2);border:1px solid var(--border2);border-radius:var(--r-sm);color:var(--text);font-family:var(--font-b);font-size:0.9em;">
<option value="">Selecciona una selecci√≥n...</option>
</select>
<div id="mPtsSubLabel" style="font-size:0.75em;color:var(--gold);margin-top:4px;font-weight:700;"></div>
</div>
<div class="field">
<label>ü•â ¬øQui√©n quedar√° Tercero?</label>
<select id="mTercero" style="width:100%;padding:13px;background:var(--surface2);border:1px solid var(--border2);border-radius:var(--r-sm);color:var(--text);font-family:var(--font-b);font-size:0.9em;">
<option value="">Selecciona una selecci√≥n...</option>
</select>
<div id="mPtsTerceroLabel" style="font-size:0.75em;color:var(--gold);margin-top:4px;font-weight:700;"></div>
</div>
<div class="field">
<label>‚öΩ ¬øQui√©n ser√° el Goleador del Torneo?</label>
<input type="text" id="mGoleador" placeholder="Ej: Kylian Mbapp√©" style="text-transform:capitalize;">
<div id="mPtsGoleadorLabel" style="font-size:0.75em;color:var(--gold);margin-top:4px;font-weight:700;"></div>
</div>
<div id="mundialSavedMsg" class="hidden" style="background:rgba(0,229,160,0.1);border:1px solid var(--green);border-radius:var(--r-sm);padding:12px;margin-bottom:12px;font-size:0.85em;color:var(--green);font-weight:700;">
‚úÖ Ya registraste tus predicciones mundiales. No pueden modificarse.
</div>
<button class="btn btn-primary" id="mundialSaveBtn" onclick="saveMundialPreds()">üåç Confirmar Predicciones</button>
</div>
</div>
<button class="btn btn-ghost" style="margin-top:8px;" onclick="closeModal('mundialModal')">Cerrar</button>
</div>
</div>
<!-- Stats Modal -->
<div class="modal-overlay hidden" id="statsModal">
<div class="modal-box">
<div class="modal-handle"></div>
<div id="statsContent"></div>
<button class="btn btn-ghost" style="margin-top:16px;" onclick="closeModal('statsModal')">Cerrar</button>
</div>
</div>
<script>
const fbConfig = {
apiKey:"AIzaSyCGfPIf-Q1x90hTne1tCMWNFuS0hio4CtA",
authDomain:"quiniela-luan-25.firebaseapp.com",
projectId:"quiniela-luan-25",
storageBucket:"quiniela-luan-25.firebasestorage.app",
messagingSenderId:"360325608839",
appId:"1:360325608839:web:900af9bafc56bbcbfacf22"
};
firebase.initializeApp(fbConfig);
const auth = firebase.auth();
const db   = firebase.firestore();
const API_KEY = '333289';
const API_V1  = `https://www.thesportsdb.com/api/v1/json/${API_KEY}`;
const API_V2  = `https://www.thesportsdb.com/api/v2/json`;
const TOURNAMENTS = [
{ id:'ucl',      name:'Champions League', flag:'‚≠ê', lid:'4480' },
{ id:'uel',      name:'Europa League',    flag:'üåç', lid:'4481' },
{ id:'bundesliga', name:'Bundesliga',     flag:'üá©üá™', lid:'4331' },
{ id:'ligue1',   name:'Ligue 1',          flag:'üá´üá∑', lid:'4334' },
{ id:'seriea',   name:'Serie A',          flag:'üáÆüáπ', lid:'4332' },
{ id:'premier',  name:'Premier League',   flag:'ENGüè¥', lid:'4328' },
{ id:'laliga',   name:'LaLiga',           flag:'üá™üá∏', lid:'4335' },
{ id:'mundial',  name:'Copa del Mundo 2026', flag:'üåçüèÜ', lid:'4429', isMundial:true },
];
const MUNDIAL_TEAMS = [
'üá¶üá∑ Argentina','üáßüá∑ Brasil','üá∫üáæ Uruguay','üá®üá¥ Colombia','üá™üá® Ecuador',
'üáµüá™ Per√∫','üáªüá™ Venezuela','üáµüáæ Paraguay','üá®üá± Chile','üáßüá¥ Bolivia',
'üá∫üá∏ Estados Unidos','üá≤üáΩ M√©xico','üá®üá¶ Canad√°','üá®üá∑ Costa Rica','üáµüá¶ Panam√°',
'üáØüá≤ Jamaica','üá≠üá≥ Honduras','üá∏üáª El Salvador','üá¨üáπ Guatemala','üáπüáπ Trinidad y Tobago',
'üá©üá™ Alemania','üá´üá∑ Francia','üá™üá∏ Espa√±a','üáµüáπ Portugal','üá¨üáß Inglaterra',
'üá≥üá± Pa√≠ses Bajos','üáÆüáπ Italia','üáßüá™ B√©lgica','üá≠üá∑ Croacia','üáµüá± Polonia',
'üá∑üá∏ Serbia','üá¶üáπ Austria','üá®üá≠ Suiza','üá©üá∞ Dinamarca','üá∏üá™ Suecia','üáπüá∑ Turqu√≠a',
'üá≤üá¶ Marruecos','üá≥üá¨ Nigeria','üá∏üá≥ Senegal','üá™üá¨ Egipto','üá®üá≤ Camer√∫n',
'üáøüá¶ Sud√°frica','üá¨üá≠ Ghana','üá®üáÆ Costa de Marfil','üáπüá≥ T√∫nez',
'üáØüáµ Jap√≥n','üá∞üá∑ Corea del Sur','üáÆüá∑ Ir√°n','üá¶üá∫ Australia','üá∏üá¶ Arabia Saudita',
'üá∂üá¶ Qatar','üá∫üáø Uzbekist√°n','üáÆüá∂ Iraq',
'üá≥üáø Nueva Zelanda',
];
const COUNTRIES = [
{f:'üáªüá™',n:'Venezuela',d:'+58'},{f:'üá∫üá∏',n:'Estados Unidos',d:'+1'},
{f:'üá≤üáΩ',n:'M√©xico',d:'+52'},{f:'üá®üá¥',n:'Colombia',d:'+57'},
{f:'üáµüá™',n:'Per√∫',d:'+51'},{f:'üá¶üá∑',n:'Argentina',d:'+54'},
{f:'üá®üá±',n:'Chile',d:'+56'},{f:'üá™üá®',n:'Ecuador',d:'+593'},
{f:'üáßüá¥',n:'Bolivia',d:'+591'},{f:'üáµüáæ',n:'Paraguay',d:'+595'},
{f:'üá∫üáæ',n:'Uruguay',d:'+598'},{f:'üáßüá∑',n:'Brasil',d:'+55'},
{f:'üáµüá¶',n:'Panam√°',d:'+507'},{f:'üá®üá∑',n:'Costa Rica',d:'+506'},
{f:'üá¨üáπ',n:'Guatemala',d:'+502'},{f:'üá≠üá≥',n:'Honduras',d:'+504'},
{f:'üá∏üáª',n:'El Salvador',d:'+503'},{f:'üá≥üáÆ',n:'Nicaragua',d:'+505'},
{f:'üá©üá¥',n:'Rep. Dominicana',d:'+1809'},{f:'üá®üá∫',n:'Cuba',d:'+53'},
{f:'üáµüá∑',n:'Puerto Rico',d:'+1787'},{f:'üá™üá∏',n:'Espa√±a',d:'+34'},
{f:'üá¨üáß',n:'Reino Unido',d:'+44'},{f:'üá©üá™',n:'Alemania',d:'+49'},
{f:'üá´üá∑',n:'Francia',d:'+33'},{f:'üáÆüáπ',n:'Italia',d:'+39'},
{f:'üá≥üá±',n:'Pa√≠ses Bajos',d:'+31'},{f:'üáµüáπ',n:'Portugal',d:'+351'},
{f:'üá®üá¶',n:'Canad√°',d:'+1'},{f:'üá¶üá∫',n:'Australia',d:'+61'},
];
let me = null;
let myTournaments = [];
let allMatches = [];
let dayMatches = [];
let userEnteringPreds = false;
let syncTimer = null;
let chatUnsub = null;
let currentCountryTarget = null;
let simPlayers = [];
let simMatches = [];
let simPredictions = {};
let simGroup = null;
let selectedCountry = { login: COUNTRIES[0], reg: COUNTRIES[0], reset: COUNTRIES[0] };
const CACHE_KEY_MATCHES  = 'ql_matches_v3';
const CACHE_KEY_SYNC     = 'ql_last_sync';
const CACHE_TTL_MATCHES  = 5 * 60 * 1000;
const CACHE_TTL_LIVE     = 30 * 1000;
const CHAT_PAGE_SIZE     = 40;
function cacheSet(key, data) {
try { localStorage.setItem(key, JSON.stringify({t: Date.now(), d: data})); } catch(e) {}
}
function cacheGet(key, maxAge) {
try {
const raw = localStorage.getItem(key);
if (!raw) return null;
const {t, d} = JSON.parse(raw);
if (Date.now() - t > maxAge) return null;
return d;
} catch(e) { return null; }
}
function cacheInvalidate(key) {
try { localStorage.removeItem(key); } catch(e) {}
}
const $ = id => document.getElementById(id);
const randCode = () => Math.random().toString(36).substring(2,8).toUpperCase();
function toast(msg, type='info', dur=3500) {
const t = document.createElement('div');
t.className = `toast toast-${type}`;
t.textContent = msg;
$('toastContainer').appendChild(t);
setTimeout(() => t.remove(), dur);
}
function openModal(id) { $(id).classList.remove('hidden'); }
function closeModal(id) { $(id).classList.add('hidden'); }
function isLive(status) {
return ['1H','2H','HT','ET','P','In Play','LIVE'].includes(status);
}
function isFinished(status) {
const s = (status||'').toUpperCase();
return ['FT','AET','AP','PEN','MATCH FINISHED','FINISHED'].includes(s);
}
function statusLabel(s) {
const map = {'1H':'‚è± 1er Tiempo','HT':'‚è∏ Descanso','2H':'‚è± 2do Tiempo',
'ET':'‚è± T. Extra','P':'ü•Ö Penaltis','FT':'‚úÖ Final',
'AET':'‚úÖ Final (TE)','AP':'‚úÖ Final (Pen)','PEN':'‚úÖ Final (Pen)',
'Match Finished':'‚úÖ Final','MATCH FINISHED':'‚úÖ Final'};
return map[s] || s;
}
function sharePizarra() {
const { name, code, ranked } = _currentRankData;
if (!ranked || !ranked.length) { toast('Carga la pizarra primero','error'); return; }
const medals = ['ü•á','ü•à','ü•â'];
const now = vzNow().toLocaleTimeString('es-VE',{hour:'2-digit',minute:'2-digit',hour12:true});
const date = vzNow().toLocaleDateString('es-VE',{day:'2-digit',month:'short'});
let msg = `‚öΩ *LuAn* ¬∑ ${name}\n`;
msg += `üìÖ ${date} ${now}\n`;
msg += `${'‚ñ¨'.repeat(18)}\n`;
ranked.forEach((p, i) => {
const pos  = medals[i] || `  ${i+1}.`;
const pts  = String(p.grpPts).padStart(3);
const name = p.username.toLowerCase().padEnd(8);
const ex   = p.grpExact   ? `‚≠ê${p.grpExact}`  : '   ';
const co   = p.grpCorrect ? `üéØ${p.grpCorrect}` : '';
msg += `${pos} ${name} ${pts}p ${ex}${co}\n`;
});
msg += `${'‚ñ¨'.repeat(18)}\n`;
msg += `_üîê ${code} ¬∑ luisl√°rez ¬∑ Arichuna_`;
window.open(`https://wa.me/?text=${encodeURIComponent(msg)}`, '_blank');
}
function inviteToApp() {
const appUrl = 'https://luisla425.github.io/Quiniela/';
const code = me.personalInviteCode || '';
const nombre = me.name || me.username || '';
const msg = encodeURIComponent(
`‚öΩ QUINIELA LuAn ‚öΩ\n\n` +
`üëã ¬°Hola! Soy ${nombre} y te invito a la quiniela m√°s emocionante:\n\n` +
`üèÜ La quiniela de los campeones\n` +
`‚ö° ¬°Predice los partidos y gana! üéØ\n` +
`‚öΩ Demuestra que sabes de f√∫tbol\n` +
`üéâ Participa y divierte con: familia, amigos, panas, compa√±eros de trabajo...\n\n` +
`üåê ¬øC√≥mo participar?\n\n` +
`1. Entra al enlace:\n` +
`      üîó ${appUrl}\n` +
`2. Reg√≠strate en la plataforma\n` +
`3. Usa mi c√≥digo de invitaci√≥n:\n` +
`      üîê *C√ìDIGO: ${code}*\n\n` +
`‚úÖ ¬°Listo! Ya est√°s compitiendo.\n\n` +
`üåæ Desarrollado por un hijo de Arichuna, con pasi√≥n por el f√∫tbol\n` +
`‚Äî luisl√°rez`
);
window.open(`https://wa.me/?text=${msg}`, '_blank');
}
function userColor(username) {
const colors = [
'#f59e0b','#10b981','#3b9eff','#f472b6','#a78bfa',
'#34d399','#fb923c','#38bdf8','#e879f9','#4ade80',
'#facc15','#60a5fa','#f87171','#a3e635','#2dd4bf'
];
let hash = 0;
for(let i=0;i<username.length;i++) hash = username.charCodeAt(i)+((hash<<5)-hash);
return colors[Math.abs(hash) % colors.length];
}
function escapeHtml(s) {
return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
}
function vzNow() {
const now = new Date();
const utcMs = now.getTime() + now.getTimezoneOffset() * 60000;
return new Date(utcMs - 4 * 3600000);
}
function vzDate() { return vzNow().toISOString().split('T')[0]; }
function vzTime(t) {
if (!t) return '--:--';
const [h,m] = t.split(':');
const utcH = +h;
const vzH = (utcH - 4 + 24) % 24;
const ampm = vzH >= 12 ? 'pm' : 'am';
const h12 = vzH % 12 || 12;
return `${h12}:${m} ${ampm}`;
}
function startClock() {
const tick = () => {
const now = vzNow();
$('hdrClock').textContent = now.toLocaleTimeString('es-VE',{
hour:'2-digit', minute:'2-digit', second:'2-digit', hour12:true
});
};
tick(); setInterval(tick, 1000);
}
function openCountryPicker(target) {
currentCountryTarget = target;
filterCountries('');
openModal('countryModal');
setTimeout(()=>$('countrySearch').focus(), 100);
}
function closeCountryPicker(e) {
if (e.target.id === 'countryModal') closeModal('countryModal');
}
function filterCountries(q) {
const list = $('countryList');
const filtered = q ? COUNTRIES.filter(c=>c.n.toLowerCase().includes(q.toLowerCase())||c.d.includes(q)) : COUNTRIES;
list.innerHTML = filtered.map(c=>`
<div class="country-option" onclick="selectCountry('${c.d}','${c.f}','${c.n}')">
<span>${c.f}</span><span class="dial">${c.d}</span><span>${c.n}</span>
</div>`).join('');
}
function selectCountry(dial, flag, name) {
selectedCountry[currentCountryTarget] = {d:dial,f:flag,n:name};
const btnId = currentCountryTarget==='login'?'loginCountryBtn':currentCountryTarget==='reg'?'regCountryBtn':'resetCountryBtn';
$(btnId).textContent = `${flag} ${dial} ‚ñæ`;
closeModal('countryModal');
}
function switchAuthTab(tab) {
['login','register','reset'].forEach(t=>{
$(`form${t.charAt(0).toUpperCase()+t.slice(1)}`)?.classList.add('hidden');
$(`tab${t.charAt(0).toUpperCase()+t.slice(1)}`)?.classList.remove('active');
});
$(`form${tab.charAt(0).toUpperCase()+tab.slice(1)}`).classList.remove('hidden');
if (tab!=='reset') {
$(`tab${tab.charAt(0).toUpperCase()+tab.slice(1)}`).classList.add('active');
}
}
function showReset() {
$('formLogin').classList.add('hidden');
$('formReset').classList.remove('hidden');
}
function phoneToEmail(phone, target) {
const raw = phone.replace(/\D/g,'');
const code = selectedCountry[target].d.replace('+','');
return code + raw.replace(/^0/,'') + '@quiniela.app';
}
async function doLogin() {
const phone = $('loginPhone').value.trim();
const pass  = $('loginPass').value;
if (!phone) { toast('Ingresa tu tel√©fono','error'); return; }
if (!pass)  { toast('Ingresa tu contrase√±a','error'); return; }
const btn = document.querySelector('#formLogin .btn-primary');
if (btn) { btn.disabled = true; btn.textContent = '‚è≥ Entrando...'; }
const email = phoneToEmail(phone, 'login');
try {
await auth.signInWithEmailAndPassword(email, pass);
} catch(e) {
const msg = e.code==='auth/wrong-password' ? '‚ùå Contrase√±a incorrecta'
: e.code==='auth/user-not-found'  ? '‚ùå Tel√©fono no registrado'
: e.code==='auth/too-many-requests'? '‚ùå Demasiados intentos. Espera unos minutos'
: e.code==='auth/network-request-failed' ? '‚ùå Sin conexi√≥n'
: '‚ùå Error: ' + e.message;
toast(msg,'error');
if (btn) { btn.disabled = false; btn.textContent = 'Entrar ‚Üí'; }
}
}
async function doRegister() {
const name     = $('regName').value.trim();
const username = $('regUsername').value.trim().toUpperCase();
const phone    = $('regPhone').value.trim();
const pass     = $('regPass').value;
const invite   = $('regInvite').value.trim().toUpperCase();
if (!name)           { toast('Ingresa tu nombre','error'); return; }
if (!username)       { toast('Ingresa un apodo','error'); return; }
if (username.length > 8) { toast('Apodo m√°ximo 8 caracteres','error'); return; }
if (!phone)          { toast('Ingresa tu tel√©fono','error'); return; }
if (pass.length < 6) { toast('Contrase√±a m√≠nimo 6 caracteres','error'); return; }
const btn = document.querySelector('#formRegister .btn-primary');
if (btn) { btn.disabled = true; btn.textContent = '‚è≥ Registrando...'; }
try {
const email = phoneToEmail(phone, 'reg');
const countryCode = selectedCountry.reg.d.replace('+','');
const fullPhone = '+' + countryCode + phone.replace(/^0/,'').replace(/\D/g,'');
const cred = await auth.createUserWithEmailAndPassword(email, pass);
const uid  = cred.user.uid;
const uCheck = await db.collection('users').where('username','==',username).limit(1).get();
if (!uCheck.empty) {
await cred.user.delete();
toast('‚ùå Ese apodo ya est√° en uso','error');
if (btn) { btn.disabled=false; btn.textContent='Crear cuenta ‚Üí'; }
return;
}
const allSnap = await db.collection('users').get();
const playerNumber = allSnap.size + 1;
const isFirst = allSnap.empty;
await db.collection('users').doc(uid).set({
name, username,
phone: fullPhone,
phoneDisplay: `${selectedCountry.reg.f} ${selectedCountry.reg.d} ${phone.replace(/^0/,'')}`,
personalInviteCode: randCode(),
isAdmin: isFirst,
playerNumber,
points: 0, exactPredictions: 0, correctResults: 0,
invitedBy: invite || 'DIRECT',
tournaments: ['ucl','uel'],
createdAt: firebase.firestore.FieldValue.serverTimestamp()
});
toast('‚úÖ Cuenta creada. Entrando...','success');
} catch(e) {
const msg = e.code==='auth/email-already-in-use' ? 'Ese tel√©fono ya est√° registrado'
: e.code==='auth/weak-password' ? 'Contrase√±a muy d√©bil (m√≠n. 6 caracteres)'
: e.code==='auth/network-request-failed' ? 'Sin conexi√≥n. Revisa tu internet'
: e.message;
toast('‚ùå '+msg,'error');
} finally {
if (btn) { btn.disabled = false; btn.textContent = 'Crear cuenta ‚Üí'; }
}
}
async function doReset() {
const phone = $('resetPhone').value.trim();
if (!phone) { toast('Ingresa tu tel√©fono','error'); return; }
const email = phoneToEmail(phone, 'reset');
try {
await auth.sendPasswordResetEmail(email);
toast('‚úÖ Enlace enviado','success');
} catch(e) {
toast('Tel√©fono no encontrado','error');
}
}
async function doLogout() {
clearTimeout(syncTimer);
if (chatUnsub) chatUnsub();
await auth.signOut();
}
async function doChangePass() {
const oldPass = $('cpOld').value;
const newPass = $('cpNew').value;
const newPass2 = $('cpNew2').value;
if (!oldPass || !newPass) { toast('Completa todos los campos','error'); return; }
if (newPass.length < 6) { toast('M√≠nimo 6 caracteres','error'); return; }
if (newPass !== newPass2) { toast('Las contrase√±as no coinciden','error'); return; }
try {
const user = auth.currentUser;
const cred = firebase.auth.EmailAuthProvider.credential(user.email, oldPass);
await user.reauthenticateWithCredential(cred);
await user.updatePassword(newPass);
closeModal('changePassModal');
toast('‚úÖ Contrase√±a cambiada exitosamente','success');
} catch(e) {
if (e.code==='auth/wrong-password') toast('‚ùå Contrase√±a actual incorrecta','error');
else toast('Error: '+e.message,'error');
}
}
auth.onAuthStateChanged(async user => {
if (user) {
let doc = null;
for (let i = 0; i < 5; i++) {
doc = await db.collection('users').doc(user.uid).get();
if (doc.exists) break;
await new Promise(r => setTimeout(r, 600));
}
if (!doc || !doc.exists) {
toast('‚ùå Error al cargar tu perfil. Intenta de nuevo.','error');
await auth.signOut();
return;
}
me = { uid: user.uid, ...doc.data() };
myTournaments = me.tournaments || ['ucl','uel'];
enterApp();
} else {
$('authScreen').classList.remove('hidden');
$('mainApp').classList.add('hidden');
const btn = document.querySelector('#formLogin .btn-primary');
if (btn) { btn.disabled = false; btn.textContent = 'Entrar ‚Üí'; }
}
});
async function enterApp() {
$('authScreen').classList.add('hidden');
$('mainApp').classList.remove('hidden');
try {
const resetDoc = await db.collection('passResets').doc(me.uid).get();
if (resetDoc.exists && !resetDoc.data().used) {
setTimeout(() => {
toast('üîë Entraste con contrase√±a temporal. C√°mbiala ahora.','warning', 6000);
openModal('changePassModal');
db.collection('passResets').doc(me.uid).update({used: true});
}, 1500);
}
} catch(e) {}
$('hdrName').textContent = me.username;
$('hdrCode').textContent = me.personalInviteCode || '‚Äî';
if (me.playerNumber) $('hdrPlayerNum').textContent = '#' + me.playerNumber;
if (me.isAdmin) {
$('hdrAdminBadge').classList.remove('hidden');
$('nav-admin').classList.remove('hidden');
}
startClock();
showScreen('matches');
loadMatches();
function scheduleNextSync() {
const hasLive = dayMatches.some(m => isLive(m.status));
const interval = hasLive ? 45000 : 300000;
syncTimer = setTimeout(async () => {
if (!userEnteringPreds) {
const hasTodayGames = dayMatches.length > 0;
if (hasTodayGames) await doSync();
else await autoEval();
}
scheduleNextSync();
}, interval);
}
scheduleNextSync();
}
function showScreen(name) {
['matches','preds','chat','tournaments','groups','admin','simulator'].forEach(s => {
const scr = $(`screen${s.charAt(0).toUpperCase()+s.slice(1)}`);
if (scr) scr.classList.add('hidden');
$(`nav-${s}`)?.classList.remove('active');
});
const target = $(`screen${name.charAt(0).toUpperCase()+name.slice(1)}`);
if (target) target.classList.remove('hidden');
$(`nav-${name}`)?.classList.add('active');
if (name !== 'chat' && chatUnsub) { chatUnsub(); chatUnsub = null; }
if (name==='preds')        renderPreds();
if (name==='chat')         initChat();
if (name==='tournaments')  renderTournaments();
if (name==='groups')       renderGroups();
if (name==='admin')        renderAdmin();
if (name==='simulator')    renderSimulator();
}
async function loadMatches() {
const cached = cacheGet(CACHE_KEY_MATCHES, CACHE_TTL_MATCHES);
if (cached && cached.length) {
allMatches = cached;
setDayMatches();
renderMatches();
const hasLive = dayMatches.some(m => isLive(m.status));
const lastSync = +localStorage.getItem(CACHE_KEY_SYNC) || 0;
const sinceLast = Date.now() - lastSync;
if (sinceLast < CACHE_TTL_MATCHES && !hasLive) return;
}
await doSync();
}
async function doSync() {
const found = new Map();
try {
const res = await fetch(`${API_V2}/livescore/soccer`);
if (res.ok) {
const data = await res.json();
const lives = data?.livescore || data?.events || [];
lives.forEach(ev => {
const t = TOURNAMENTS.find(t => t.lid === ev.idLeague);
if (t && myTournaments.includes(t.id)) found.set(ev.idEvent, parseEvent(ev,t));
});
}
} catch(e) {}
for (const t of TOURNAMENTS) {
if (!myTournaments.includes(t.id)) continue;
try {
const r = await fetch(`${API_V1}/eventsnextleague.php?id=${t.lid}`);
if (r.ok) { const d=await r.json(); (d?.events||[]).forEach(ev=>found.set(ev.idEvent,parseEvent(ev,t))); }
} catch(e) {}
try {
const r = await fetch(`${API_V1}/eventspastleague.php?id=${t.lid}`);
if (r.ok) { const d=await r.json(); (d?.events||[]).forEach(ev=>found.set(ev.idEvent,parseEvent(ev,t))); }
} catch(e) {}
}
try {
const fsSnap = await db.collection('matches').get();
fsSnap.docs.forEach(d=>{
if (!found.has(d.id)) found.set(d.id,{id:d.id,...d.data()});
});
} catch(e) {}
if (!found.size) { renderMatches(); return; }
allMatches = Array.from(found.values());
await refreshDayScores();
const today = vzDate();
const toWrite = Array.from(found.values()).filter(m => m.date === today);
if (toWrite.length) {
try {
const b = db.batch();
toWrite.forEach(m => b.set(db.collection('matches').doc(String(m.id)), m, {merge:true}));
await b.commit();
} catch(e) {}
}
cacheSet(CACHE_KEY_MATCHES, allMatches);
localStorage.setItem(CACHE_KEY_SYNC, Date.now());
setDayMatches();
renderMatches();
await autoEval();
}
async function refreshDayScores() {
const today = vzDate();
const targets = allMatches.filter(m => m.date===today || m.date===vzDate());
if (!targets.length) return;
const batch = db.batch();
for (const m of targets) {
try {
const r = await fetch(`${API_V1}/lookupevent.php?id=${m.id}`);
if (!r.ok) continue;
const data = await r.json();
const ev = data?.events?.[0];
if (!ev) continue;
const upd = {
homeScore: ev.intHomeScore!=null?+ev.intHomeScore:null,
awayScore: ev.intAwayScore!=null?+ev.intAwayScore:null,
status: ev.strStatus||'Not Started',
minute: ev.strProgress||ev.intProgress||null,
homeGoals: ev.strHomeGoalDetails||'',
awayGoals: ev.strAwayGoalDetails||'',
};
const idx = allMatches.findIndex(x=>String(x.id)===String(m.id));
if (idx!==-1) allMatches[idx]={...allMatches[idx],...upd};
batch.set(db.collection('matches').doc(String(m.id)),upd,{merge:true});
} catch(e) {}
}
try { await batch.commit(); } catch(e) {}
}
function parseEvent(ev, t) {
const hs = ev.intHomeScore??ev.homeScore??null;
const as = ev.intAwayScore??ev.awayScore??null;
return {
id: String(ev.idEvent||ev.id),
home: ev.strHomeTeam||ev.home_team,
away: ev.strAwayTeam||ev.away_team,
date: ev.dateEvent||ev.date,
time: ev.strTime||ev.time||'00:00',
homeScore: hs!=null?+hs:null,
awayScore: as!=null?+as:null,
status: ev.strStatus||'Not Started',
minute: ev.strProgress||ev.intProgress||null,
homeGoals: ev.strHomeGoalDetails||'',
awayGoals: ev.strAwayGoalDetails||'',
tournamentId: t.id,
tournamentName: t.name,
tournamentFlag: t.flag,
round: ev.intRound||1,
};
}
function setDayMatches() {
const today = vzDate();
let pool = allMatches.filter(m=>m.date===today);
if (!pool.length) {
const upcoming = allMatches.filter(m=>m.date>today).sort((a,b)=>a.date.localeCompare(b.date));
const nextDate = upcoming[0]?.date;
pool = nextDate ? allMatches.filter(m=>m.date===nextDate) : [];
}
dayMatches = pool.sort((a,b)=>(a.time||'').localeCompare(b.time||''));
}
function bettingClosed() {
return dayMatches.some(m => isLive(m.status) || isFinished(m.status));
}
function renderMatches() {
const el = $('screenMatches');
if (!el) return;
const saved = {};
dayMatches.forEach(m=>{
const hi=$(`hi_${m.id}`),ai=$(`ai_${m.id}`);
if(hi&&ai&&(hi.value!=='0'||ai.value!=='0')) saved[m.id]={h:hi.value,a:ai.value};
});
const closed = bettingClosed();
const nextClose = !closed ? dayMatches.find(m=>m.status==='Not Started') : null;
let html = `
<div class="section-header">
<span class="section-title">‚öΩ Partidos</span>
<button class="btn btn-ghost btn-sm" onclick="doSync()">üîÑ Sync</button>
</div>`;
if (nextClose) {
const matchTimeStr = nextClose.time;
const [mh,mm] = matchTimeStr.split(':').map(Number);
const nowVZ = vzNow();
const matchVZ = new Date(nowVZ);
matchVZ.setHours((mh - 4 + 24) % 24, mm, 0, 0);
if (matchVZ < nowVZ) matchVZ.setDate(matchVZ.getDate() + 1);
const diffMs = matchVZ - nowVZ;
const diffH = Math.floor(diffMs / 3600000);
const diffM = Math.floor((diffMs % 3600000) / 60000);
const diffS = Math.floor((diffMs % 60000) / 1000);
const countdown = diffMs > 0
? (diffH > 0 ? `${diffH}h ${diffM}m` : `${diffM}m ${diffS}s`)
: 'AHORA';
html += `<div class="countdown-banner">
<div>
<div class="countdown-label">‚è∞ Cierre en: <strong style="color:var(--red);">${countdown}</strong></div>
<div class="countdown-match" style="font-size:0.82em;margin-top:2px;">${nextClose.home} vs ${nextClose.away}</div>
</div>
<div class="countdown-status">${vzTime(nextClose.time)}</div>
</div>`;
}
if (closed) {
html += `<div class="countdown-banner" style="background:rgba(255,77,109,0.08);border-color:rgba(255,77,109,0.3);">
<span style="color:var(--red);font-weight:800;">üî¥ Predicciones CERRADAS</span>
<span style="font-size:0.78em;color:var(--muted2);">Partidos en curso</span>
</div>`;
}
if (!dayMatches.length) {
html += `<div class="empty"><span class="empty-icon">üì≠</span><span class="empty-text">Sin partidos. Pulsa Sync.</span></div>`;
} else {
dayMatches.forEach(m => { html += buildMatchCard(m, closed); });
if (!closed) {
html += `<button class="btn btn-primary" style="margin-top:8px;" onclick="savePreds()">üíæ Guardar Predicciones</button>`;
}
}
el.innerHTML = html;
Object.entries(saved).forEach(([mid,v])=>{
const hi=$(`hi_${mid}`),ai=$(`ai_${mid}`);
if(hi)hi.value=v.h; if(ai)ai.value=v.a;
});
}
function buildMatchCard(m, closed) {
const live = isLive(m.status);
const done = isFinished(m.status);
const showScore = live || done;
const cls = live?'live':done?'finished':'';
let badge = '';
if (live) badge = `<span class="badge-live">üî¥ ${statusLabel(m.status)}</span>`;
else if (done) badge = `<span class="badge-done">${statusLabel(m.status)}</span>`;
else badge = `<span class="badge-time">${vzTime(m.time)}</span>`;
let centerContent = '';
if (showScore) {
centerContent = `
<div style="text-align:center;">
<div style="display:flex;align-items:center;justify-content:center;gap:8px;">
<span class="team-score ${live?'score-live':'score-final'}">${m.homeScore??'?'}</span>
<span style="color:var(--muted);font-family:var(--font-h);font-size:1.2em;">‚Äî</span>
<span class="team-score ${live?'score-live':'score-final'}">${m.awayScore??'?'}</span>
</div>
${m.minute?`<div style="font-size:0.72em;color:var(--red);font-weight:700;margin-top:2px;">‚è± ${m.minute}'</div>`:''}
</div>`;
} else {
centerContent = `<span class="vs-divider">VS</span>`;
}
let goalsHtml = '';
if (showScore && (m.homeGoals||m.awayGoals)) {
goalsHtml = `<div class="goal-list">`;
if (m.homeGoals) m.homeGoals.split(';').filter(Boolean).forEach(g=>{
goalsHtml += `<div class="goal-item goal-home">‚öΩ ${g.trim()}</div>`;
});
if (m.awayGoals) m.awayGoals.split(';').filter(Boolean).forEach(g=>{
goalsHtml += `<div class="goal-item goal-away">‚öΩ ${g.trim()}</div>`;
});
goalsHtml += `</div>`;
}
const statsBtn = showScore ? `<button class="stats-btn" onclick="openStats('${m.id}')">üìä Estad√≠sticas & Goles</button>` : '';
const predRow = (!showScore && !closed) ? `
<div class="pred-row" style="margin-top:8px;">
<input type="number" min="0" max="99" value="0" id="hi_${m.id}" class="pred-input" oninput="userEnteringPreds=true">
<span class="pred-dash">‚Äî</span>
<input type="number" min="0" max="99" value="0" id="ai_${m.id}" class="pred-input" oninput="userEnteringPreds=true">
</div>` : '';
return `
<div class="match-card ${cls}">
<div class="match-meta">
<span>${m.tournamentFlag||'üåç'} ${m.tournamentName}</span>
${badge}
</div>
<div class="match-teams">
<div class="team">
<span class="team-flag">‚öΩ</span>
<span class="team-name">${m.home}</span>
</div>
${centerContent}
<div class="team">
<span class="team-flag">‚öΩ</span>
<span class="team-name">${m.away}</span>
</div>
</div>
${goalsHtml}
${predRow}
${statsBtn}
</div>`;
}
async function openStats(matchId) {
openModal('statsModal');
$('statsContent').innerHTML = '<div class="empty"><span class="empty-icon">‚è≥</span><span class="empty-text">Cargando estad√≠sticas...</span></div>';
try {
const r = await fetch(`${API_V1}/lookupevent.php?id=${matchId}`);
const data = await r.json();
const ev = data?.events?.[0];
if (!ev) { $('statsContent').innerHTML='<div class="empty"><span class="empty-text">Sin datos disponibles</span></div>'; return; }
const hs = ev.intHomeScore ?? '?';
const as = ev.intAwayScore ?? '?';
const live = isLive(ev.strStatus);
const scoreColor = live ? 'var(--red)' : 'var(--green)';
let html = `
<div style="text-align:center;padding-bottom:16px;border-bottom:1px solid var(--border);margin-bottom:16px;">
<div style="font-size:0.72em;color:var(--muted2);font-weight:700;text-transform:uppercase;letter-spacing:1px;margin-bottom:10px;">${ev.strLeague}</div>
<div style="display:grid;grid-template-columns:1fr auto 1fr;align-items:center;gap:8px;margin-bottom:10px;">
<div style="text-align:center;">
<div style="font-size:0.78em;font-weight:800;color:var(--text);">${ev.strHomeTeam}</div>
</div>
<div style="display:flex;align-items:center;gap:10px;">
<span style="font-family:var(--font-h);font-size:2.8em;color:${scoreColor};">${hs}</span>
<span style="font-family:var(--font-h);font-size:1.4em;color:var(--muted);">‚Äî</span>
<span style="font-family:var(--font-h);font-size:2.8em;color:${scoreColor};">${as}</span>
</div>
<div style="text-align:center;">
<div style="font-size:0.78em;font-weight:800;color:var(--text);">${ev.strAwayTeam}</div>
</div>
</div>
<span class="${live?'badge-live':'badge-done'}">${statusLabel(ev.strStatus)}</span>
${ev.strProgress ? `<span style="color:var(--red);font-size:0.8em;font-weight:700;margin-left:8px;">‚è± ${ev.strProgress}'</span>` : ''}
${ev.strVenue ? `<div style="font-size:0.7em;color:var(--muted2);margin-top:6px;">üèüÔ∏è ${ev.strVenue}</div>` : ''}
</div>`;
function parseEvents(str) {
if (!str) return [];
return str.split(';').map(s=>s.trim()).filter(Boolean);
}
function sectionTitle(icon, title) {
return `<div style="display:flex;align-items:center;gap:8px;font-weight:800;font-size:0.8em;text-transform:uppercase;letter-spacing:1px;color:var(--muted2);margin:14px 0 8px;">
<span>${icon}</span><span>${title}</span>
</div>`;
}
function eventRow(minute, team, player, icon, color) {
return `<div style="display:flex;align-items:center;gap:10px;padding:8px 0;border-bottom:1px solid var(--border);">
<span style="font-family:var(--font-h);font-size:0.85em;color:var(--muted2);min-width:32px;">${minute ? minute+"'" : ''}</span>
<span style="font-size:1em;">${icon}</span>
<div style="flex:1;">
<div style="font-weight:700;font-size:0.85em;color:${color};">${player}</div>
<div style="font-size:0.7em;color:var(--muted2);">${team}</div>
</div>
</div>`;
}
const homeGoals = parseEvents(ev.strHomeGoalDetails);
const awayGoals = parseEvents(ev.strAwayGoalDetails);
if (homeGoals.length || awayGoals.length) {
html += sectionTitle('‚öΩ', `Goles (${homeGoals.length + awayGoals.length})`);
const allGoals = [
...homeGoals.map(g=>({g, team:ev.strHomeTeam, color:'var(--text)', side:'home'})),
...awayGoals.map(g=>({g, team:ev.strAwayTeam, color:'var(--blue)',  side:'away'}))
];
allGoals.sort((a,b)=>{
const ma = parseInt(a.g.match(/(\d+)'/)?.[1]||'0');
const mb = parseInt(b.g.match(/(\d+)'/)?.[1]||'0');
return ma - mb;
});
allGoals.forEach(({g,team,color,side})=>{
const minMatch = g.match(/(\d+)\+?(\d+)?'/);
const min = minMatch ? minMatch[0].replace("'","") + "'" : '';
let player = g.replace(/\(?\d+\+?\d*'\)?/g,'').trim();
if (!player) player = g;
const isOG = g.toLowerCase().includes('og') || g.toLowerCase().includes('propia');
const icon = isOG ? 'üî¥‚öΩ' : '‚öΩ';
const ogLabel = isOG ? ' <span style="color:var(--red);font-size:0.75em;">(Autogol)</span>' : '';
html += `<div style="display:flex;align-items:center;gap:10px;padding:10px 0;border-bottom:1px solid var(--border);">
<span style="font-family:var(--font-h);font-size:0.9em;color:var(--gold);min-width:40px;font-weight:800;">${min||'?'}</span>
<span style="font-size:1.1em;">${icon}</span>
<div style="flex:1;">
<div style="font-weight:800;font-size:0.88em;color:${color};">${player}${ogLabel}</div>
<div style="font-size:0.7em;color:var(--muted2);margin-top:2px;">
${side==='home'?'üè†':'‚úàÔ∏è'} ${team}
</div>
</div>
</div>`;
});
} else if (live) {
html += sectionTitle('‚öΩ', 'Goles');
html += `<div style="padding:12px 0;color:var(--muted2);font-size:0.82em;text-align:center;">
‚è≥ Esperando datos de la API...
<div style="font-size:0.85em;margin-top:4px;">El marcador se actualiza en tiempo real</div>
</div>`;
}
const homeYellow = parseEvents(ev.strHomeYellowCards);
const awayYellow = parseEvents(ev.strAwayYellowCards);
if (homeYellow.length || awayYellow.length) {
html += sectionTitle('üü®', 'Tarjetas Amarillas');
[...homeYellow.map(g=>({g,team:ev.strHomeTeam})),
...awayYellow.map(g=>({g,team:ev.strAwayTeam}))].forEach(({g,team})=>{
const min = g.match(/(\d+)'/)?.[1] || '';
const player = g.replace(/\(?\d+'\)?/,'').trim() || g;
html += eventRow(min, team, player, 'üü®', 'var(--gold)');
});
}
const homeRed = parseEvents(ev.strHomeRedCards);
const awayRed = parseEvents(ev.strAwayRedCards);
if (homeRed.length || awayRed.length) {
html += sectionTitle('üü•', 'Tarjetas Rojas');
[...homeRed.map(g=>({g,team:ev.strHomeTeam})),
...awayRed.map(g=>({g,team:ev.strAwayTeam}))].forEach(({g,team})=>{
const min = g.match(/(\d+)'/)?.[1] || '';
const player = g.replace(/\(?\d+'\)?/,'').trim() || g;
html += eventRow(min, team, player, 'üü•', 'var(--red)');
});
}
const homeSubs = parseEvents(ev.strHomeLineupSubstitutes);
const awaySubs = parseEvents(ev.strAwayLineupSubstitutes);
const homeSubsAlt = parseEvents(ev.strHomeSubstitutes);
const awaySubsAlt = parseEvents(ev.strAwaySubstitutes);
const allHomeSubs = [...new Set([...homeSubs, ...homeSubsAlt])].filter(Boolean);
const allAwaySubs = [...new Set([...awaySubs, ...awaySubsAlt])].filter(Boolean);
if (allHomeSubs.length || allAwaySubs.length) {
html += sectionTitle('üîÑ', 'Cambios');
[...allHomeSubs.map(g=>({g,team:ev.strHomeTeam})),
...allAwaySubs.map(g=>({g,team:ev.strAwayTeam}))].forEach(({g,team})=>{
const min = g.match(/(\d+)'/)?.[1] || '';
const player = g.replace(/\(?\d+'\)?/,'').trim() || g;
html += eventRow(min, team, player, 'üîÑ', 'var(--muted2)');
});
}
const homeLineup = ev.strHomeLineupGoalkeeper ? [
ev.strHomeLineupGoalkeeper,
ev.strHomeLineupDefense,
ev.strHomeLineupMidfield,
ev.strHomeLineupForward
].filter(Boolean) : [];
const awayLineup = ev.strAwayLineupGoalkeeper ? [
ev.strAwayLineupGoalkeeper,
ev.strAwayLineupDefense,
ev.strAwayLineupMidfield,
ev.strAwayLineupForward
].filter(Boolean) : [];
if (homeLineup.length || awayLineup.length) {
html += sectionTitle('üëï', 'Alineaciones');
html += `<div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;">`;
html += `<div>
<div style="font-size:0.72em;font-weight:800;color:var(--primary2);margin-bottom:6px;text-transform:uppercase;">${ev.strHomeTeam}</div>`;
const homeLabels = ['üß§','üõ°Ô∏è','‚öôÔ∏è','‚ö°'];
homeLineup.forEach((line,i)=>{
line.split(';').filter(Boolean).forEach(p=>{
html += `<div style="font-size:0.72em;padding:3px 0;border-bottom:1px solid var(--border);color:var(--text);">${homeLabels[i]||''} ${p.trim()}</div>`;
});
});
html += `</div>`;
html += `<div>
<div style="font-size:0.72em;font-weight:800;color:var(--blue);margin-bottom:6px;text-transform:uppercase;">${ev.strAwayTeam}</div>`;
const awayLabels = ['üß§','üõ°Ô∏è','‚öôÔ∏è','‚ö°'];
awayLineup.forEach((line,i)=>{
line.split(';').filter(Boolean).forEach(p=>{
html += `<div style="font-size:0.72em;padding:3px 0;border-bottom:1px solid var(--border);color:var(--text);">${awayLabels[i]||''} ${p.trim()}</div>`;
});
});
html += `</div></div>`;
}
if (!homeGoals.length && !awayGoals.length && !homeYellow.length &&
!awayYellow.length && !homeRed.length && !awayRed.length &&
!allHomeSubs?.length && !allAwaySubs?.length) {
html += `<div class="empty" style="padding:20px 0;">
<span class="empty-icon">${live?'‚è±':'üìã'}</span>
<span class="empty-text">${live?'Partido en curso ‚Äî datos llegando...':'Sin detalles disponibles para este partido'}</span>
</div>`;
}
$('statsContent').innerHTML = html;
} catch(e) {
$('statsContent').innerHTML = `<div class="empty"><span class="empty-text">Error: ${e.message}</span></div>`;
}
}
async function savePreds() {
if (!me?.uid) return;
if (bettingClosed()) { toast('‚õî Predicciones cerradas ‚Äî ya inici√≥ un partido','error'); return; }
const jDate = dayMatches[0]?.date;
if (!jDate) { toast('Sin partidos disponibles','error'); return; }
const preds = [];
dayMatches.forEach(m=>{
const hi=$(`hi_${m.id}`),ai=$(`ai_${m.id}`);
if(hi&&ai) preds.push({matchId:String(m.id),h:+hi.value||0,a:+ai.value||0,match:m});
});
if (!preds.length) { toast('Sin predicciones para guardar','error'); return; }
const grpSnap = await db.collection('groups').get();
const myGroups = grpSnap.docs.map(d=>({id:d.id,...d.data()})).filter(g=>g.members?.some(m=>m.userId===me.uid));
if (!myGroups.length) { toast('No perteneces a ning√∫n grupo','error'); return; }
if (myGroups.length === 1) {
await doSavePreds(preds, jDate, myGroups[0]);
} else {
const list = $('grpPickList');
list.innerHTML = '';
myGroups.forEach(g=>{
const btn = document.createElement('button');
btn.className = 'btn btn-ghost';
btn.style.marginBottom = '8px';
btn.innerHTML = `üë• ${g.name} <span style="color:var(--muted2);font-size:0.8em;">¬∑ ${g.members?.length||0} jugadores</span>`;
btn.onclick = async()=>{ closeModal('grpPickModal'); await doSavePreds(preds,jDate,g); };
list.appendChild(btn);
});
openModal('grpPickModal');
}
}
async function doSavePreds(preds, jDate, group) {
try {
const ex = await db.collection('predictions')
.where('userId','==',me.uid).where('jornadaDate','==',jDate).where('groupId','==',group.id).limit(1).get();
if (!ex.empty) { toast(`Ya predijiste para "${group.name}" hoy`,'error'); return; }
} catch(e) {}
const summary = preds.map(p=>`${p.match.home} ${p.h}‚Äî${p.a} ${p.match.away}`).join('\n');
if (!confirm(`üìã GRUPO: ${group.name}\n\n${summary}\n\n¬øConfirmar predicciones? No podr√°s cambiarlas.`)) return;
try {
const b = db.batch();
preds.forEach(p=>{
const docId = `${me.uid}_${group.id}_${p.matchId}`;
b.set(db.collection('predictions').doc(docId),{
userId:me.uid, username:me.username,
groupId:group.id, groupName:group.name,
matchId:String(p.matchId),
predictedHomeScore:p.h, predictedAwayScore:p.a,
home:p.match.home, away:p.match.away,
tournamentId:p.match.tournamentId, jornadaDate:jDate,
evaluated:false,
timestamp:firebase.firestore.FieldValue.serverTimestamp()
});
});
await b.commit();
userEnteringPreds = false;
toast(`‚úÖ ${preds.length} predicciones guardadas para "${group.name}"!`,'success');
} catch(e) {
toast('Error al guardar: '+e.message,'error');
}
}
async function renderPreds() {
const el = $('screenPreds');
el.innerHTML = '<div class="empty"><span class="empty-icon">‚è≥</span></div>';
const closed = bettingClosed();
const canSearch = me.isAdmin || closed;
let html = `<div class="section-header"><span class="section-title">üéØ Mis Predicciones</span></div>`;
if (!canSearch) {
html += `<div class="locked-box">
<span class="lock-icon">üîí</span>
<p>Disponible cuando empiece el primer partido</p>
<small>Las predicciones de otros jugadores son visibles una vez iniciados los juegos</small>
</div>`;
} else {
html += `<div class="card" style="margin-bottom:14px;">
<p style="font-weight:700;font-size:0.85em;margin-bottom:10px;">üîç Ver predicciones de otros jugadores</p>
<div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:8px;">
<div class="field" style="margin:0;"><input type="text" id="su1" placeholder="Jugador 1" style="text-transform:uppercase;" oninput="this.value=this.value.toUpperCase()"></div>
<div class="field" style="margin:0;"><input type="text" id="su2" placeholder="Jugador 2" style="text-transform:uppercase;" oninput="this.value=this.value.toUpperCase()"></div>
</div>
<div class="field" style="margin-bottom:8px;"><input type="text" id="su3" placeholder="Jugador 3 (opcional)" style="text-transform:uppercase;" oninput="this.value=this.value.toUpperCase()"></div>
<button class="btn btn-ghost btn-sm" onclick="searchPreds()">üîç Buscar</button>
<div id="searchRes" style="margin-top:12px;"></div>
</div>`;
}
html += `<div style="font-weight:800;font-size:0.82em;text-transform:uppercase;letter-spacing:1px;color:var(--muted2);margin-bottom:10px;">üìã Tus Predicciones</div>`;
try {
const snap = await db.collection('predictions').where('userId','==',me.uid).orderBy('timestamp','desc').limit(30).get();
if (snap.empty) {
html += `<div class="empty"><span class="empty-icon">üì≠</span><span class="empty-text">A√∫n no has predicho</span></div>`;
} else {
snap.docs.forEach(d=>{
const p = d.data();
const match = allMatches.find(m=>String(m.id)===String(p.matchId));
const hasReal = match && match.homeScore!=null;
let ptsCls = 'pts-pending', ptsLabel = '‚è≥';
if (p.evaluated) {
if (p.pointsAwarded===5) { ptsCls='pts-5'; ptsLabel='‚≠ê 5pts'; }
else if (p.pointsAwarded===3) { ptsCls='pts-3'; ptsLabel='üéØ 3pts'; }
else { ptsCls='pts-0'; ptsLabel='‚ùå 0pts'; }
} else if (hasReal && isFinished(match.status)) {
ptsLabel='‚è≥ Eval.';
}
html += `
<div class="pred-item">
<div>
<div class="pred-match-name">${p.home}</div>
<div class="pred-match-sub">vs ${p.away}</div>
</div>
<div class="pred-score-box">${p.predictedHomeScore}‚Äî${p.predictedAwayScore}</div>
${hasReal?`<div class="pred-real-box">Real<span class="pred-real-score">${match.homeScore}‚Äî${match.awayScore}</span></div>`:'<div></div>'}
<div class="pred-pts-box ${ptsCls}">${ptsLabel}</div>
</div>`;
});
}
} catch(e) {
html += `<div class="empty"><span class="empty-text">Error: ${e.message}</span></div>`;
}
el.innerHTML = html;
}
async function searchPreds() {
const names = ['su1','su2','su3'].map(id=>$(id)?.value.trim().toUpperCase()).filter(Boolean);
if (!names.length) { toast('Escribe al menos un nombre','error'); return; }
const res = $('searchRes');
res.innerHTML = '<div style="color:var(--muted2);font-size:0.85em;">Buscando...</div>';
let html = '';
for (const uname of names) {
const uSnap = await db.collection('users').where('username','==',uname).limit(1).get();
if (uSnap.empty) { html+=`<div style="color:var(--red);font-size:0.85em;padding:8px 0;">‚ùå "${uname}" no encontrado</div>`; continue; }
const u = {id:uSnap.docs[0].id,...uSnap.docs[0].data()};
const ps = await db.collection('predictions').where('userId','==',u.id).limit(30).get();
html += `<div class="card" style="margin-bottom:10px;">
<div style="font-weight:800;margin-bottom:8px;">üë§ ${u.username} <span style="color:var(--muted2);font-size:0.8em;">#${u.playerNumber||'?'}</span></div>`;
ps.docs.forEach(d=>{
const p=d.data();
html+=`<div style="display:flex;justify-content:space-between;align-items:center;padding:6px 0;border-bottom:1px solid var(--border);font-size:0.82em;">
<span>${p.home} vs ${p.away}</span>
<span style="font-family:var(--font-h);color:var(--primary2);">${p.predictedHomeScore}‚Äî${p.predictedAwayScore}</span>
</div>`;
});
html += `</div>`;
}
res.innerHTML = html || '<div style="color:var(--muted2);">Sin resultados</div>';
}
function initChat() {
const screen = $('screenChat');
screen.innerHTML = `
<div class="chat-header" style="flex-shrink:0;">
<div style="display:flex;align-items:center;gap:10px;">
<div class="chat-online"></div>
<div class="chat-header-info">
<h3>üí¨ Chat LuAn</h3>
<p>Hola ${me?.username||''} ¬∑ Escribe y env√≠a</p>
</div>
</div>
</div>
<div class="chat-messages" id="chatMessages">
<div class="chat-system">Bienvenido al chat de Quiniela LuAn ‚öΩ</div>
</div>
<div class="chat-input-bar" id="chatBar">
<input type="text" class="chat-input" id="chatInput"
placeholder="Escribe un mensaje..."
autocomplete="off" autocorrect="off"
onkeydown="if(event.key==='Enter'){event.preventDefault();sendChat();}"
/>
<button class="chat-send"
ontouchend="event.preventDefault();sendChat();"
onclick="sendChat();">‚û§</button>
</div>`;
if (chatUnsub) chatUnsub();
chatUnsub = db.collection('chat').orderBy('ts').limitToLast(CHAT_PAGE_SIZE)
.onSnapshot({includeMetadataChanges: false}, snap=>{
const el=$('chatMessages');
if(!el) return;
if (snap.metadata.fromCache && !snap.docChanges().length) return;
el.innerHTML='';
snap.docs.forEach(d=>{
const c=d.data();
const mine=c.uid===me.uid;
const time=c.ts?.toDate?.()||new Date();
const hm=time.toLocaleTimeString('es-VE',{hour:'2-digit',minute:'2-digit'});
if(c.type==='system'){
el.innerHTML+=`<div class="chat-system">${c.text}</div>`;
} else {
const displayName = c.name || c.username || 'Anon';
const uColor = mine ? 'var(--primary2)' : userColor(c.username||'x');
const bubbleStyle = mine ? '' : `border-color:${uColor}33;`;
el.innerHTML+=`<div class="chat-msg ${mine?'mine':'theirs'}">
${!mine?`<span class="chat-name" style="color:${uColor};">${escapeHtml(displayName)}</span>`:''}
<div class="chat-bubble" style="${bubbleStyle}">${escapeHtml(c.text)}</div>
<span class="chat-time">${hm}</span>
</div>`;
}
});
el.scrollTop=el.scrollHeight;
});
}
async function sendChat() {
const input = $('chatInput');
if (!input) { toast('Error: input no encontrado','error'); return; }
const text = input.value.trim();
if (!text) return;
if (!me?.uid) { toast('Debes estar autenticado','error'); return; }
input.value = '';
input.focus();
try {
await db.collection('chat').add({
uid: me.uid,
username: me.username,
name: me.name || me.username,
text: text,
ts: firebase.firestore.FieldValue.serverTimestamp()
});
} catch(e) {
input.value = text;
const msg = e.code === 'permission-denied'
? '‚ùå Sin permiso para escribir. Verifica las reglas de Firestore.'
: '‚ùå Error: ' + e.message;
toast(msg, 'error');
console.error('Chat error:', e.code, e.message);
}
}
function renderTournaments() {
const el = $('screenTournaments');
let html = `<div class="section-header"><span class="section-title">üèÜ Torneos</span></div>
<div class="card-glow" style="margin-bottom:14px;cursor:pointer;" onclick="openMundialModal()">
<div style="display:flex;align-items:center;gap:12px;">
<span style="font-size:2em;">üåçüèÜ</span>
<div style="flex:1;">
<div style="font-family:var(--font-h);font-size:1em;color:var(--gold);">Copa del Mundo 2026</div>
<div style="font-size:0.75em;color:var(--muted2);margin-top:2px;">48 selecciones ¬∑ 104 partidos ¬∑ USA/MX/CA</div>
</div>
<span style="font-size:1.5em;">‚Üí</span>
</div>
<div style="margin-top:10px;display:flex;gap:8px;flex-wrap:wrap;">
<span style="font-size:0.72em;background:rgba(245,197,66,0.15);color:var(--gold);padding:4px 10px;border-radius:20px;font-weight:700;">ü•á Campe√≥n</span>
<span style="font-size:0.72em;background:rgba(245,197,66,0.15);color:var(--gold);padding:4px 10px;border-radius:20px;font-weight:700;">ü•à Subcampe√≥n</span>
<span style="font-size:0.72em;background:rgba(245,197,66,0.15);color:var(--gold);padding:4px 10px;border-radius:20px;font-weight:700;">ü•â Tercer lugar</span>
<span style="font-size:0.72em;background:rgba(245,197,66,0.15);color:var(--gold);padding:4px 10px;border-radius:20px;font-weight:700;">‚öΩ Goleador</span>
</div>
</div>
<p style="color:var(--muted2);font-size:0.85em;margin-bottom:16px;">Selecciona las ligas para las que quieres predecir:</p>`;
TOURNAMENTS.forEach(t=>{
const sel = myTournaments.includes(t.id);
html += `<div class="tourn-item ${sel?'selected':''}" onclick="toggleTournament('${t.id}',this)">
<div class="tourn-left">
<span style="font-size:1.3em;">${t.flag}</span>
<span>${t.name}</span>
</div>
<div class="tourn-check">${sel?'‚úì':''}</div>
</div>`;
});
html += `<button class="btn btn-primary" style="margin-top:8px;" onclick="saveTournaments()">üíæ Guardar selecci√≥n</button>`;
el.innerHTML = html;
}
function toggleTournament(id, el) {
const sel = myTournaments.includes(id);
if(sel) myTournaments=myTournaments.filter(t=>t!==id); else myTournaments.push(id);
el.classList.toggle('selected',!sel);
el.querySelector('.tourn-check').textContent=!sel?'‚úì':'';
}
async function saveTournaments() {
await db.collection('users').doc(me.uid).update({tournaments:myTournaments});
me.tournaments=myTournaments;
toast('‚úÖ Torneos guardados','success');
await doSync();
}
async function renderGroups() {
const el = $('screenGroups');
el.innerHTML = '<div class="empty"><span class="empty-icon">‚è≥</span></div>';
let html = `<div class="section-header">
<span class="section-title">üë• Grupos</span>
<div style="display:flex;gap:8px;">
<button class="btn btn-ghost btn-sm" onclick="openModal('createModal')">‚ûï Crear</button>
<button class="btn btn-ghost btn-sm" onclick="openModal('joinModal')">üîó Unirse</button>
</div>
</div>`;
try {
const snap = await db.collection('groups').get();
if(me.isAdmin) html+=`<div style="background:rgba(108,71,255,0.1);border:1px solid rgba(108,71,255,0.3);border-radius:var(--r-sm);padding:8px 12px;margin-bottom:12px;font-size:0.78em;color:var(--primary2);font-weight:700;">üëë Admin ‚Äî ves todos los grupos</div>`;
let found=0;
snap.docs.forEach(doc=>{
const g=doc.data();
if(!me.isAdmin&&!g.members?.some(m=>m.userId===me.uid)) return;
found++;
const isMine=g.members?.some(m=>m.userId===me.uid);
html+=`<div class="group-card">
<div class="group-card-header">
<div>
<div class="group-name">${g.name} ${isMine?'üëë':''}</div>
<div class="group-meta">üë• ${g.members?.length||0}/${g.maxMembers} jugadores</div>
</div>
<div class="group-code">
<span class="group-code-label">C√≥digo</span>
<span class="group-code-val">${g.code}</span>
</div>
</div>
<div class="group-actions">
${me.isAdmin?`<button class="btn-del" onclick="deleteGroup('${doc.id}','${g.name}')">üóëÔ∏è</button>`:''}
<button class="btn-rank" onclick="openGroupRanking('${doc.id}')">üèÜ Ver Clasificaci√≥n</button>
<button class="btn-wa" onclick="shareGroup('${g.code}','${g.name}')">üì≤</button>
</div>
</div>`;
});
if(!found) html+=`<div class="empty"><span class="empty-icon">üë•</span><span class="empty-text">Sin grupos. Crea o √∫nete a uno.</span></div>`;
} catch(e) {
html+=`<div class="empty"><span class="empty-text">Error: ${e.message}</span></div>`;
}
el.innerHTML=html;
}
async function doCreateGroup() {
const name=$('createName').value.trim();
const max=+$('createMax').value;
if(!name){toast('Ingresa un nombre','error');return;}
const total=await db.collection('groups').get();
if(total.size>=5){toast('M√°ximo 5 grupos permitidos','error');return;}
const btn=$('createBtn'); btn.disabled=true;
try {
const code=randCode();
await db.collection('groups').add({
name,code,maxMembers:max,
createdBy:me.uid,
createdAt:new Date().toISOString(),
members:[{userId:me.uid,username:me.username,joinedAt:new Date().toISOString(),isAdmin:true}]
});
closeModal('createModal');
$('createName').value='';
toast(`‚úÖ Grupo "${name}" creado ¬∑ C√≥digo: ${code}`,'success',5000);
renderGroups();
} catch(e){toast('Error: '+e.message,'error');}
finally{btn.disabled=false;}
}
async function doJoinGroup() {
const code=$('joinCode').value.trim().toUpperCase();
const statusEl=$('joinStatus');
const btn=$('joinBtn');
const setS=(msg,t)=>{ statusEl.innerHTML=`<div class="status-box status-${t}">${msg}</div>`; };
if(code.length!==6){setS('El c√≥digo debe tener 6 caracteres','error');return;}
btn.disabled=true; setS('üîç Buscando grupo...','info');
try {
const snap=await db.collection('groups').where('code','==',code).limit(1).get();
if(snap.empty){setS('‚ùå C√≥digo incorrecto. Verifica con el admin.','error');btn.disabled=false;return;}
const gdoc=snap.docs[0]; const g=gdoc.data();
if(g.members?.some(m=>m.userId===me.uid)){setS(`‚úÖ Ya eres miembro de "${g.name}"`,'success');setTimeout(()=>closeModal('joinModal'),1500);btn.disabled=false;return;}
if(g.members?.length>=g.maxMembers){setS(`‚ùå Grupo lleno (${g.members.length}/${g.maxMembers})`,'error');btn.disabled=false;return;}
setS(`‚úÖ Grupo encontrado: "${g.name}" ¬∑ ${g.members?.length||0}/${g.maxMembers} jugadores`,'success');
await gdoc.ref.update({members:firebase.firestore.FieldValue.arrayUnion({userId:me.uid,username:me.username,joinedAt:new Date().toISOString(),isAdmin:false})});
$('joinCode').value='';
setTimeout(()=>{closeModal('joinModal');toast(`üéâ ¬°Bienvenido a "${g.name}"!`,'success');renderGroups();},1500);
} catch(e){setS('Error: '+e.message,'error');btn.disabled=false;}
}
async function deleteGroup(gid, name) {
if(!confirm(`¬øEliminar el grupo "${name}"? Esta acci√≥n no se puede deshacer.`)) return;
await db.collection('groups').doc(gid).delete();
toast('‚úÖ Grupo eliminado','success');
renderGroups();
}
function shareGroup(code, name) {
const nombre = me.name || me.username || '';
const msg = encodeURIComponent(
`‚öΩ QUINIELA LuAn ‚öΩ\n\n` +
`üëã ¬°Hola! Soy ${nombre} y tengo una invitaci√≥n imperdible para ti:\n\n` +
`üî• AL GRUPO: *"${name}"*\n\n` +
`üì≤ ¬øC√≥mo unirte?\n\n` +
`1. Abre la app Quiniela LuAn\n` +
`2. Ve a la secci√≥n Grupos\n` +
`3. Toca "Unirse"\n` +
`4. Ingresa el c√≥digo:\n` +
`   üîê *C√ìDIGO: ${code}*\n\n` +
`‚úÖ ¬°Listo! Ya ser√°s parte de la acci√≥n.\n\n` +
`üåæ Desarrollado por un hijo de Arichuna, con pasi√≥n por el f√∫tbol\n` +
`‚Äî luisl√°rez`
);
window.open(`https://wa.me/?text=${msg}`, '_blank');
}
let _currentRankData = { name:'', ranked:[] };
async function openGroupRanking(gid) {
openModal('rankModal');
$('rankModalList').innerHTML='<div class="empty"><span class="empty-icon">‚è≥</span></div>';
const gdoc=await db.collection('groups').doc(gid).get();
const g=gdoc.data();
$('rankModalTitle').textContent=`üèÜ ${g.name}`;
$('rankModalCode').textContent=`üîê C√≥digo: ${g.code}`;
const memberIds=g.members.map(m=>m.userId);
const ptMap={};
memberIds.forEach(id=>{ptMap[id]={pts:0,exact:0,correct:0};});
try {
const pSnap = await db.collection('predictions').where('groupId','==',gid).get();
pSnap.docs.forEach(d=>{
const p = d.data();
if(!ptMap[p.userId]) ptMap[p.userId]={pts:0,exact:0,correct:0,live:0};
const pts = p.evaluated ? (p.pointsAwarded||0) : (p.livePoints!=null ? p.livePoints : 0);
const isLiveScore = !p.evaluated && p.livePoints != null;
ptMap[p.userId].pts += pts;
ptMap[p.userId].live += isLiveScore ? 1 : 0;
if(pts===5) ptMap[p.userId].exact++;
else if(pts===3) ptMap[p.userId].correct++;
});
if(memberIds.length <= 10) {
const oldPreds = await db.collection('predictions')
.where('userId','in',memberIds).get();
oldPreds.docs.forEach(d=>{
const p=d.data();
if(p.groupId) return;
if(!ptMap[p.userId]) ptMap[p.userId]={pts:0,exact:0,correct:0,live:0};
const pts = p.evaluated ? (p.pointsAwarded||0) : (p.livePoints!=null ? p.livePoints : 0);
ptMap[p.userId].pts += pts;
if(pts===5) ptMap[p.userId].exact++;
else if(pts===3) ptMap[p.userId].correct++;
});
}
const allU=[];
for(let i=0;i<memberIds.length;i+=10){
const chunk=memberIds.slice(i,i+10);
const us=await db.collection('users').where(firebase.firestore.FieldPath.documentId(),'in',chunk).get();
us.docs.forEach(d=>allU.push({id:d.id,...d.data()}));
}
const ranked=allU.map(u=>({...u,
grpPts:ptMap[u.id]?.pts||0,
grpExact:ptMap[u.id]?.exact||0,
grpCorrect:ptMap[u.id]?.correct||0,
grpLive:ptMap[u.id]?.live||0
})).sort((a,b)=>b.grpPts-a.grpPts||b.grpExact-a.grpExact);
const anyLive = allMatches.some(m=>isLive(m.status));
const nowStr = vzNow().toLocaleTimeString('es-VE',{hour:'2-digit',minute:'2-digit',hour12:true});
let html = anyLive
? `<div style="background:rgba(255,77,109,0.1);border:1px solid rgba(255,77,109,0.3);border-radius:8px;padding:8px 12px;margin-bottom:12px;font-size:0.78em;display:flex;justify-content:space-between;">
<span style="color:var(--red);font-weight:800;">üî¥ Puntos en vivo</span>
<span style="color:var(--muted2);">Actualizado: ${nowStr}</span>
</div>`
: `<div style="font-size:0.75em;color:var(--muted2);margin-bottom:12px;text-align:right;">Actualizado: ${nowStr}</div>`;
html += `<div style="display:flex;justify-content:space-between;font-size:0.72em;color:var(--muted2);font-weight:700;text-transform:uppercase;letter-spacing:1px;padding:0 12px 8px;">
<span>Jugador</span><span>‚≠ê ¬∑ üéØ</span><span>Pts</span></div>`;
ranked.forEach((u,i)=>{
const isMe=u.id===me.uid;
const medal=i===0?'ü•á':i===1?'ü•à':i===2?'ü•â':`#${i+1}`;
const hasLiveGames = u.grpLive > 0;
html+=`<div class="rank-row ${isMe?'me':''}">
<span class="rank-pos">${medal}</span>
<div class="rank-name">
${u.username}${isMe?' <span style="color:var(--primary2);font-size:0.75em;">(T√ö)</span>':''}
<div class="rank-sub">‚≠ê${u.grpExact} exactos ¬∑ üéØ${u.grpCorrect} correctos</div>
</div>
<div class="rank-pts" style="display:flex;flex-direction:column;align-items:flex-end;">
<span>${u.grpPts}</span>
${hasLiveGames?`<span style="font-size:0.6em;color:var(--red);animation:pulse 2s infinite;">üî¥ VIVO</span>`:''}
</div>
</div>`;
});
_currentRankData = { name: g.name, code: g.code, ranked };
$('rankModalList').innerHTML=html||'<div class="empty"><span class="empty-text">Sin datos a√∫n</span></div>';
} catch(e){
$('rankModalList').innerHTML=`<div class="empty"><span class="empty-text">Error: ${e.message}</span></div>`;
}
}
function calcPoints(ph, pa, rh, ra) {
const pr = ph===pa?'empate':ph>pa?'home':'away';
const rr = rh===ra?'empate':rh>ra?'home':'away';
if(ph===rh && pa===ra) return 5;
if(pr===rr) return 3;
return 0;
}
async function autoEval() {
const active = allMatches.filter(m =>
(isLive(m.status) || isFinished(m.status)) && m.homeScore != null
);
if(!active.length) return;
let updated = 0;
for(const match of active) {
const rh = +match.homeScore;
const ra = +match.awayScore;
const isFinal = isFinished(match.status);
try {
const snaps = await Promise.all([
db.collection('predictions').where('matchId','==',String(match.id)).get(),
db.collection('predictions').where('matchId','==',match.id).get()
]);
const seen = new Set(); const docs = [];
snaps.forEach(s=>s.docs.forEach(d=>{if(!seen.has(d.id)){seen.add(d.id);docs.push(d);}}));
for(const pd of docs) {
const p = pd.data();
const ph = +p.predictedHomeScore;
const pa = +p.predictedAwayScore;
const pts = calcPoints(ph, pa, rh, ra);
const prevLive = p.livePoints;
const prevEval = p.evaluated;
if(prevLive === pts && prevEval === isFinal) continue;
const upd = {
livePoints: pts,
liveHome: rh,
liveAway: ra,
liveStatus: match.status,
};
if(isFinal && !p.evaluated) {
upd.evaluated = true;
upd.pointsAwarded = pts;
upd.realHome = rh;
upd.realAway = ra;
if(pts > 0) {
const userUpd = {points: firebase.firestore.FieldValue.increment(pts)};
if(pts===5) userUpd.exactPredictions = firebase.firestore.FieldValue.increment(1);
if(pts===3) userUpd.correctResults = firebase.firestore.FieldValue.increment(1);
await db.collection('users').doc(p.userId).update(userUpd);
}
}
await pd.ref.update(upd);
updated++;
}
} catch(e){ console.warn('autoEval error:', match.id, e.message); }
}
if(updated > 0) console.log(`üìä ${updated} predicciones actualizadas`);
}
function renderAdmin() {
const el=$('screenAdmin');
el.innerHTML=`
<div class="section-header"><span class="section-title">‚öôÔ∏è Admin</span></div>
<div class="card-glow" style="margin-bottom:16px;">
<div style="font-family:var(--font-h);font-size:0.8em;color:var(--muted2);margin-bottom:4px;">PANEL ADMIN</div>
<div style="font-family:var(--font-h);font-size:1.3em;">üëë ${me.username}</div>
</div>
<div class="admin-grid">
<button class="admin-btn" onclick="adminUsers()">üë•<br>Ver Usuarios</button>
<button class="admin-btn" onclick="adminEval()">‚ö°<br>Evaluar Partidos</button>
<button class="admin-btn warn" onclick="adminEvalManual()">üîß<br>Evaluar Manual</button>
<button class="admin-btn accent" onclick="adminShowGroups()">üìã<br>C√≥digos Grupos</button>
<button class="admin-btn full" onclick="adminSync()">üîÑ Sincronizar Partidos Ahora</button>
<button class="admin-btn full danger" onclick="adminReset()">üóëÔ∏è Borrar Datos</button>
</div>
<div class="admin-output" id="adminOut"><span style="color:var(--muted2);">Selecciona una acci√≥n...</span></div>`;
}
async function adminUsers() {
const out=$('adminOut');
out.innerHTML='‚è≥ Cargando...';
const snap = await db.collection('users').orderBy('playerNumber').get();
const predSnap = await db.collection('predictions').where('evaluated','==',true).get();
const realPts = {};
predSnap.docs.forEach(d=>{
const p = d.data();
if(!realPts[p.userId]) realPts[p.userId]={pts:0,exact:0,correct:0};
realPts[p.userId].pts += p.pointsAwarded||0;
if(p.pointsAwarded===5) realPts[p.userId].exact++;
else if(p.pointsAwarded===3) realPts[p.userId].correct++;
});
const liveSnap = await db.collection('predictions').where('evaluated','==',false).get();
const livePts = {};
liveSnap.docs.forEach(d=>{
const p = d.data();
if(p.livePoints==null) return;
if(!livePts[p.userId]) livePts[p.userId]=0;
livePts[p.userId]+=p.livePoints;
});
let html=`<div class="big-stat"><span class="big-stat-num">${snap.size}</span><span class="big-stat-label">Jugadores Registrados</span></div>`;
snap.docs.forEach(d=>{
const u=d.data();
const rp = realPts[d.id]||{pts:0,exact:0,correct:0};
const lp = livePts[d.id]||0;
const totalPts = rp.pts + lp;
const liveLabel = lp>0 ? `<span style="color:var(--red);font-size:0.7em;"> +${lp}üî¥</span>` : '';
html+=`<div style="background:var(--surface2);border:1px solid var(--border);border-radius:var(--r-sm);padding:12px;margin-bottom:8px;">
<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px;">
<div>
<span style="color:var(--muted2);font-size:0.75em;">#${u.playerNumber||'?'}</span>
<strong style="margin-left:6px;">${u.username}</strong>
${u.isAdmin?'üëë':''}
</div>
<div style="text-align:right;">
<span style="font-family:var(--font-h);color:var(--primary2);">${totalPts}pts</span>${liveLabel}
<div style="font-size:0.68em;color:var(--muted2);">‚≠ê${rp.exact} exactos ¬∑ üéØ${rp.correct} correctos</div>
</div>
</div>
<div style="font-size:0.72em;color:var(--muted2);">${u.phoneDisplay||u.phone||'‚Äî'} ¬∑ Inv: ${u.personalInviteCode}</div>
<div style="display:flex;gap:6px;margin-top:8px;">
<button class="btn-wa" style="flex:1;" onclick="adminWA('${u.username}','${u.phone||''}')">üì≤ WhatsApp</button>
<button style="flex:1;padding:9px;background:rgba(245,197,66,0.15);border:1px solid rgba(245,197,66,0.3);color:var(--gold);border-radius:var(--r-sm);font-family:var(--font-b);font-weight:700;font-size:0.75em;cursor:pointer;" onclick="adminResetUserPass('${u.username}','${u.phone||''}','${d.id}')">üîë Reset Clave</button>
</div>
</div>`;
});
out.innerHTML=html;
}
function adminWA(username, phone) {
if(!phone){toast('Sin tel√©fono registrado','error');return;}
const num=phone.replace(/[^0-9]/g,'');
const msg=encodeURIComponent(`Hola ${username}! üëã Te escribimos desde Quiniela LuAn ‚öΩ`);
window.open(`https://wa.me/${num}?text=${msg}`,'_blank');
}
async function adminResetUserPass(username, phone, uid) {
const tempPass = 'Luan' + Math.floor(1000+Math.random()*9000);
if (!confirm(`¬øResetear contrase√±a de ${username}?\n\nContrase√±a temporal: ${tempPass}\n\nSe la enviar√°s por WhatsApp.`)) return;
try {
await db.collection('passResets').doc(uid).set({
uid, username,
tempPass,
requestedBy: me.uid,
requestedAt: firebase.firestore.FieldValue.serverTimestamp(),
used: false
});
const num = phone.replace(/[^0-9]/g,'');
const msg = encodeURIComponent(
`üîë Quiniela LuAn ‚Äî Reset de contrase√±a\n\n` +
`Hola ${username}! Tu contrase√±a temporal es:\n\n` +
`*${tempPass}*\n\n` +
`Entra con esta clave y c√°mbiala desde el men√∫ de tu perfil.`
);
window.open(`https://wa.me/${num}?text=${msg}`, '_blank');
toast(`‚úÖ Contrase√±a temporal generada para ${username}`,'success');
} catch(e) {
toast('Error: '+e.message,'error');
}
}
async function adminEval() {
if(!confirm('¬øEvaluar todos los partidos finalizados?')) return;
const out=$('adminOut'); out.innerHTML='‚è≥ Evaluando...';
try {
const fsSnap=await db.collection('matches').get();
if(!fsSnap.empty) allMatches=fsSnap.docs.map(d=>({id:d.id,...d.data()}));
} catch(e){}
const fin=allMatches.filter(m=>isFinished(m.status)&&m.homeScore!=null);
if(!fin.length){out.innerHTML='‚ö†Ô∏è Sin partidos finalizados en memoria. Haz Sync primero.';return;}
let total=0,pts=0;
for(const match of fin){
const rh=+match.homeScore,ra=+match.awayScore;
const rr=rh===ra?'empate':rh>ra?'home':'away';
const s1=await db.collection('predictions').where('matchId','==',String(match.id)).where('evaluated','==',false).get();
const s2=await db.collection('predictions').where('matchId','==',match.id).where('evaluated','==',false).get();
const seen=new Set();const docs=[];
[s1,s2].forEach(s=>s.docs.forEach(d=>{if(!seen.has(d.id)){seen.add(d.id);docs.push(d);}}));
for(const pd of docs){
const p=pd.data();let points=0;
const ph=+p.predictedHomeScore,pa=+p.predictedAwayScore;
const pr=ph===pa?'empate':ph>pa?'home':'away';
if(ph===rh&&pa===ra) points=5;
else if(pr===rr) points=3;
pts+=points;
await pd.ref.update({evaluated:true,pointsAwarded:points,realHome:rh,realAway:ra});
if(points>0){
const upd={points:firebase.firestore.FieldValue.increment(points)};
if(points===5) upd.exactPredictions=firebase.firestore.FieldValue.increment(1);
if(points===3) upd.correctResults=firebase.firestore.FieldValue.increment(1);
await db.collection('users').doc(p.userId).update(upd);
}
total++;
}
}
out.innerHTML=`‚úÖ ${total} predicciones evaluadas ¬∑ ${pts} puntos distribuidos`;
}
async function adminEvalManual() {
const matchesWithScores=allMatches.filter(m=>m.homeScore!=null&&m.awayScore!=null);
if(!matchesWithScores.length){out.innerHTML='‚ö†Ô∏è Sin partidos con resultados en memoria.';return;}
if(!confirm(`¬øEvaluar usando ${matchesWithScores.length} partidos con resultados?`)) return;
const out=$('adminOut'); out.innerHTML='‚è≥ Evaluando...';
let total=0,pts=0;
for(const match of matchesWithScores){
const rh=+match.homeScore,ra=+match.awayScore;
const rr=rh===ra?'empate':rh>ra?'home':'away';
const s1=await db.collection('predictions').where('matchId','==',String(match.id)).where('evaluated','==',false).get();
const s2=await db.collection('predictions').where('matchId','==',match.id).where('evaluated','==',false).get();
const seen=new Set();const docs=[];
[s1,s2].forEach(s=>s.docs.forEach(d=>{if(!seen.has(d.id)){seen.add(d.id);docs.push(d);}}));
for(const pd of docs){
const p=pd.data();let points=0;
const ph=+p.predictedHomeScore,pa=+p.predictedAwayScore;
const pr=ph===pa?'empate':ph>pa?'home':'away';
if(ph===rh&&pa===ra) points=5;
else if(pr===rr) points=3;
pts+=points;
await pd.ref.update({evaluated:true,pointsAwarded:points,realHome:rh,realAway:ra});
if(points>0){
const upd={points:firebase.firestore.FieldValue.increment(points)};
if(points===5) upd.exactPredictions=firebase.firestore.FieldValue.increment(1);
if(points===3) upd.correctResults=firebase.firestore.FieldValue.increment(1);
await db.collection('users').doc(p.userId).update(upd);
}
total++;
}
}
out.innerHTML=total?`‚úÖ ${total} predicciones evaluadas ¬∑ ${pts} puntos`:'‚ö†Ô∏è Sin predicciones sin evaluar';
}
async function adminShowGroups() {
const out=$('adminOut'); out.innerHTML='‚è≥ Cargando...';
const snap=await db.collection('groups').get();
if(snap.empty){out.innerHTML='Sin grupos creados';return;}
let html=`<p style="font-weight:800;margin-bottom:12px;color:var(--primary2);">üìã GRUPOS (${snap.size}/5)</p>`;
snap.docs.forEach(doc=>{
const g=doc.data();
html+=`<div style="background:var(--surface2);border:1px solid var(--border);border-radius:var(--r-sm);padding:12px;margin-bottom:8px;">
<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
<strong>${g.name}</strong>
<span style="font-family:var(--font-h);font-size:1.4em;color:var(--primary2);letter-spacing:3px;">${g.code}</span>
</div>
<div style="font-size:0.75em;color:var(--muted2);margin-bottom:8px;">üë• ${g.members?.length||0}/${g.maxMembers}</div>
<div style="display:flex;gap:8px;">
<button class="btn-wa" style="flex:1;" onclick="shareGroup('${g.code}','${g.name}')">üì≤ Compartir WA</button>
<button class="btn btn-ghost btn-sm" onclick="copyCode('${g.code}','${g.name}')">üìã Copiar</button>
</div>
</div>`;
});
out.innerHTML=html;
}
function copyCode(code, name) {
const msg=`√önete a "${name}" en Quiniela LuAn ‚öΩ\nC√≥digo: ${code}`;
navigator.clipboard?.writeText(msg).then(()=>toast('‚úÖ Copiado','success')).catch(()=>toast(`C√≥digo: ${code}`,'info',6000));
}
async function adminSync() {
const out=$('adminOut'); out.innerHTML='‚è≥ Sincronizando...';
await doSync();
out.innerHTML=`‚úÖ Sync completado ¬∑ ${allMatches.length} partidos`;
}
async function adminReset() {
const opt=confirm('MODO A: Solo predicciones (Aceptar)\nMODO B: Todo (Cancelar)');
if(opt===null) return;
if(opt){
if(!confirm('¬øBorrar predicciones y resetear puntos?')) return;
const ps=await db.collection('predictions').get();
const b=db.batch(); ps.docs.forEach(d=>b.delete(d.ref)); await b.commit();
const us=await db.collection('users').get();
const b2=db.batch(); us.docs.forEach(d=>b2.update(d.ref,{points:0,exactPredictions:0,correctResults:0})); await b2.commit();
toast('‚úÖ Predicciones borradas','success');
} else {
const code=prompt('Escribe BORRAR-TODO para confirmar:');
if(code!=='BORRAR-TODO'){toast('Cancelado','error');return;}
for(const col of ['users','predictions','groups','chat']){
const s=await db.collection(col).get();
const b=db.batch(); s.docs.forEach(d=>b.delete(d.ref)); await b.commit();
}
toast('‚úÖ Base de datos limpiada','success');
doLogout();
}
}
function renderSimulator() {
const el = $('screenSimulator');
el.innerHTML = `
<div class="section-header">
<span class="section-title">üéÆ Simulador</span>
</div>
<div class="card-glow" style="margin-bottom:14px;">
<p style="color:var(--muted2);font-size:0.82em;line-height:1.6;">
¬øQu√© pasar√≠a si...? Pon resultados ficticios y ve c√≥mo quedar√≠a la pizarra de tu grupo. <strong style="color:var(--gold);">No afecta los puntos reales.</strong>
</p>
</div>
<div class="field">
<label>üë• Grupo a simular</label>
<select id="simGroupSel" style="width:100%;padding:13px 16px;background:var(--surface2);border:1px solid var(--border2);border-radius:var(--r-sm);color:var(--text);font-family:var(--font-b);font-size:0.95em;">
<option value="">Cargando grupos...</option>
</select>
</div>
<div class="field">
<label>üìÖ Partidos a simular</label>
<select id="simMatchSel" style="width:100%;padding:13px 16px;background:var(--surface2);border:1px solid var(--border2);border-radius:var(--r-sm);color:var(--text);font-family:var(--font-b);font-size:0.95em;">
<option value="pending">Solo pendientes (sin resultado)</option>
<option value="all">Todos los de hoy</option>
</select>
</div>
<button class="btn btn-primary" onclick="loadSimulation()">üîÑ Cargar Simulaci√≥n</button>
<div id="simSetup" class="hidden" style="margin-top:16px;">
<div style="font-weight:800;font-size:0.82em;text-transform:uppercase;letter-spacing:1px;color:var(--muted2);margin-bottom:10px;">‚ö° Escenarios R√°pidos</div>
<div style="display:flex;flex-wrap:wrap;gap:8px;margin-bottom:16px;">
<span class="scenario-chip" onclick="applyScenario('myExact')">üéØ Mi exacto</span>
<span class="scenario-chip" onclick="applyScenario('myResult')">‚úÖ Mi resultado</span>
<span class="scenario-chip" onclick="applyScenario('leaderExact')">ü•á Exacto del l√≠der</span>
<span class="scenario-chip" onclick="applyScenario('nobody')">‚ùå Nadie acierta</span>
<span class="scenario-chip" onclick="applyScenario('random')">üé≤ Aleatorio</span>
<span class="scenario-chip" onclick="clearSimInputs()">üóëÔ∏è Limpiar</span>
</div>
<div id="simMatchesList"></div>
<button class="btn btn-green" onclick="runSimulation()" style="margin-top:8px;">üöÄ Ejecutar Simulaci√≥n</button>
</div>
<div id="simResults" class="hidden" style="margin-top:16px;">
<div id="simAnalysis" class="sim-analysis" style="margin-bottom:14px;"></div>
<div style="font-weight:800;font-size:0.82em;text-transform:uppercase;letter-spacing:1px;color:var(--muted2);margin-bottom:10px;">üìä Pizarra Ficticia</div>
<div id="simRanking"></div>
<button class="btn btn-ghost" onclick="resetSimulation()" style="margin-top:12px;">üîÑ Nueva Simulaci√≥n</button>
</div>`;
loadSimGroups();
}
async function loadSimGroups() {
const sel = $('simGroupSel');
if (!sel) return;
try {
const snap = await db.collection('groups').get();
const myGroups = snap.docs.map(d=>({id:d.id,...d.data()}))
.filter(g => g.members?.some(m=>m.userId===me.uid) || me.isAdmin);
if (!myGroups.length) {
sel.innerHTML = '<option>No perteneces a ning√∫n grupo</option>';
return;
}
sel.innerHTML = myGroups.map(g=>`<option value="${g.id}">${g.name}</option>`).join('');
} catch(e) { sel.innerHTML = '<option>Error cargando grupos</option>'; }
}
async function loadSimulation() {
const gid = $('simGroupSel')?.value;
const matchFilter = $('simMatchSel')?.value;
if (!gid) { toast('Selecciona un grupo','error'); return; }
toast('‚è≥ Cargando...','info');
try {
const gdoc = await db.collection('groups').doc(gid).get();
simGroup = {id:gid,...gdoc.data()};
const memberIds = simGroup.members.map(m=>m.userId);
simPlayers = [];
for(let i=0;i<memberIds.length;i+=10){
const chunk=memberIds.slice(i,i+10);
const us=await db.collection('users').where(firebase.firestore.FieldPath.documentId(),'in',chunk).get();
us.docs.forEach((d,idx)=>simPlayers.push({id:d.id,...d.data(),originalRank:0}));
}
const pSnap = await db.collection('predictions').where('groupId','==',gid).where('evaluated','==',true).get();
const ptMap = {};
pSnap.docs.forEach(d=>{
const p=d.data();
if(!ptMap[p.userId]) ptMap[p.userId]=0;
ptMap[p.userId]+=(p.pointsAwarded||0);
});
simPlayers = simPlayers.map(p=>({...p, groupPoints: ptMap[p.id]||0}))
.sort((a,b)=>b.groupPoints-a.groupPoints)
.map((p,i)=>({...p, originalRank:i+1}));
const today = vzDate();
if (matchFilter==='pending') {
simMatches = dayMatches.filter(m=>!isFinished(m.status)&&!isLive(m.status));
} else {
simMatches = dayMatches;
}
if (!simMatches.length) {
simMatches = allMatches.filter(m=>m.date>today).slice(0,6);
}
if (!simMatches.length) { toast('No hay partidos para simular','error'); return; }
simPredictions = {};
const matchIds = simMatches.map(m=>String(m.id));
for(const player of simPlayers){
const ps = await db.collection('predictions')
.where('userId','==',player.id)
.where('groupId','==',gid).get();
simPredictions[player.id] = ps.docs.map(d=>d.data())
.filter(p=>matchIds.includes(String(p.matchId)));
}
$('simSetup').classList.remove('hidden');
$('simResults').classList.add('hidden');
renderSimMatches();
toast(`‚úÖ ${simMatches.length} partidos ¬∑ ${simPlayers.length} jugadores`,'success');
} catch(e) { toast('Error: '+e.message,'error'); }
}
function renderSimMatches() {
const el = $('simMatchesList');
if (!el) return;
el.innerHTML = simMatches.map(m=>`
<div class="sim-match-card">
<div style="font-size:0.72em;color:var(--muted2);font-weight:700;text-transform:uppercase;margin-bottom:8px;">
${m.tournamentFlag||'üåç'} ${m.tournamentName}
${isLive(m.status)?'<span class="badge-live" style="margin-left:6px;">üî¥ VIVO</span>':''}
</div>
<div style="display:grid;grid-template-columns:1fr auto 1fr;align-items:center;gap:8px;">
<div style="text-align:center;">
<span style="font-size:1.8em;">‚öΩ</span>
<div style="font-size:0.7em;font-weight:800;color:var(--muted2);text-transform:uppercase;">${m.home}</div>
</div>
<div class="sim-score-row">
<input type="number" min="0" max="99" value="${m.homeScore!=null?m.homeScore:0}"
id="simH_${m.id}" class="sim-input" inputmode="numeric">
<span style="font-family:var(--font-h);color:var(--muted);font-size:1.2em;">‚Äî</span>
<input type="number" min="0" max="99" value="${m.awayScore!=null?m.awayScore:0}"
id="simA_${m.id}" class="sim-input" inputmode="numeric">
</div>
<div style="text-align:center;">
<span style="font-size:1.8em;">‚öΩ</span>
<div style="font-size:0.7em;font-weight:800;color:var(--muted2);text-transform:uppercase;">${m.away}</div>
</div>
</div>
</div>`).join('');
}
function applyScenario(type) {
simMatches.forEach(m=>{
const hi=$(`simH_${m.id}`), ai=$(`simA_${m.id}`);
if(!hi||!ai) return;
switch(type){
case 'myExact': {
const p = simPredictions[me.uid]?.find(p=>String(p.matchId)===String(m.id));
if(p){ hi.value=p.predictedHomeScore; ai.value=p.predictedAwayScore; }
break;
}
case 'myResult': {
const p = simPredictions[me.uid]?.find(p=>String(p.matchId)===String(m.id));
if(p){
const d=p.predictedHomeScore-p.predictedAwayScore;
if(d>0){ hi.value=p.predictedHomeScore+1; ai.value=p.predictedAwayScore; }
else if(d<0){ hi.value=p.predictedHomeScore; ai.value=p.predictedAwayScore+1; }
else { hi.value=1; ai.value=1; }
}
break;
}
case 'leaderExact': {
const leader = simPlayers[0];
const p = leader && simPredictions[leader.id]?.find(p=>String(p.matchId)===String(m.id));
if(p){ hi.value=p.predictedHomeScore; ai.value=p.predictedAwayScore; }
break;
}
case 'nobody':
hi.value=7; ai.value=0; break;
case 'random':
hi.value=Math.floor(Math.random()*5);
ai.value=Math.floor(Math.random()*5);
break;
}
});
if(type!=='nobody'&&type!=='random') toast('‚úÖ Escenario aplicado','success');
}
function clearSimInputs() {
simMatches.forEach(m=>{
const hi=$(`simH_${m.id}`), ai=$(`simA_${m.id}`);
if(hi) hi.value=0; if(ai) ai.value=0;
});
}
function runSimulation() {
const fictResults = simMatches.map(m=>({
matchId:String(m.id),
homeScore:+($(`simH_${m.id}`)?.value||0),
awayScore:+($(`simA_${m.id}`)?.value||0),
home:m.home, away:m.away
}));
const results = simPlayers.map(player=>{
let gained=0, exactGained=0, resultGained=0;
const preds = simPredictions[player.id]||[];
fictResults.forEach(fr=>{
const pred = preds.find(p=>String(p.matchId)===fr.matchId);
if(!pred) return;
const pts = calcPoints(+pred.predictedHomeScore, +pred.predictedAwayScore, fr.homeScore, fr.awayScore);
gained+=pts;
if(pts===5) exactGained++;
else if(pts===3) resultGained++;
});
return {
...player,
fictPoints: player.groupPoints + gained,
gained, exactGained, resultGained
};
}).sort((a,b)=>b.fictPoints-a.fictPoints||b.exactGained-a.exactGained)
.map((p,i)=>({...p, newRank:i+1}));
displaySimResults(results, fictResults);
$('simResults').classList.remove('hidden');
$('simResults').scrollIntoView({behavior:'smooth'});
}
function displaySimResults(players, fictResults) {
const me_ = players.find(p=>p.id===me.uid);
const myNewRank = me_?.newRank||0;
const myOldRank = me_?.originalRank||0;
const rankChange = myOldRank - myNewRank;
let analysis = `<div style="font-family:var(--font-h);font-size:1em;color:var(--primary2);margin-bottom:10px;">üéÆ RESULTADO SIMULADO</div>`;
if(me_){
analysis += `<div style="font-size:0.88em;line-height:1.8;">`;
analysis += `üìç Tu posici√≥n: <strong style="color:var(--gold);">${myOldRank}¬∞ ‚Üí ${myNewRank}¬∞</strong> `;
if(rankChange>0) analysis+=`<span style="color:var(--green);">‚ñ≤ Subes ${rankChange}</span>`;
else if(rankChange<0) analysis+=`<span style="color:var(--red);">‚ñº Bajas ${Math.abs(rankChange)}</span>`;
else analysis+=`<span style="color:var(--muted2);">Sin cambios</span>`;
analysis += `<br>‚≠ê Exactos ficticios: <strong>${me_.exactGained}</strong>`;
analysis += `<br>üéØ Resultados ficticios: <strong>${me_.resultGained}</strong>`;
analysis += `<br>‚ûï Puntos ganados: <strong style="color:var(--green);">+${me_.gained}</strong>`;
analysis += `<br>üèÜ Total ficticio: <strong style="color:var(--primary2);">${me_.fictPoints} pts</strong>`;
if(myNewRank===1) analysis+=`<br><br>üéâ <strong style="color:var(--gold);">¬°Ser√≠as el l√≠der!</strong>`;
else {
const leader = players[0];
const diff = leader.fictPoints - (me_?.fictPoints||0);
if(diff>0) analysis+=`<br>üìè A <strong>${diff} pts</strong> del l√≠der (${leader.username})`;
}
analysis += `</div>`;
}
$('simAnalysis').innerHTML = analysis;
let html = `
<div style="display:grid;grid-template-columns:auto 1fr auto auto;gap:0;font-size:0.7em;font-weight:800;text-transform:uppercase;letter-spacing:1px;color:var(--muted);padding:0 12px 8px;">
<span>Pos</span><span style="padding-left:10px;">Jugador</span><span style="text-align:right;">+Pts</span><span style="text-align:right;padding-left:8px;">Total</span>
</div>`;
players.forEach((p,i)=>{
const isMe = p.id===me.uid;
const isLeader = i===0;
const medal = i===0?'ü•á':i===1?'ü•à':i===2?'ü•â':`#${i+1}`;
const chg = p.originalRank - p.newRank;
const chgHtml = chg>0
? `<span style="color:var(--green);font-size:0.75em;">‚ñ≤${chg}</span>`
: chg<0
? `<span style="color:var(--red);font-size:0.75em;">‚ñº${Math.abs(chg)}</span>`
: `<span style="color:var(--muted);font-size:0.75em;">‚Äî</span>`;
html+=`<div class="sim-result-row ${isMe?'me':''} ${isLeader&&!isMe?'leader':''}">
<span class="sim-pos">${medal}</span>
<div class="sim-name">
${p.username}${isMe?' <span style="color:var(--gold);font-size:0.75em;">(T√ö)</span>':''}
<div style="font-size:0.7em;color:var(--muted2);">
Antes: ${p.groupPoints}pts ${chgHtml}
</div>
</div>
<span class="sim-gain">+${p.gained}</span>
<span class="sim-pts">${p.fictPoints}</span>
</div>`;
});
html += `<div style="margin-top:14px;padding:12px;background:var(--surface2);border-radius:var(--r-sm);font-size:0.78em;">
<div style="font-weight:800;color:var(--muted2);text-transform:uppercase;letter-spacing:1px;margin-bottom:8px;">üìã Resultados ficticios usados</div>`;
fictResults.forEach(fr=>{
const rr = fr.homeScore===fr.awayScore?'empate':fr.homeScore>fr.awayScore?fr.home:fr.away;
html+=`<div style="display:flex;justify-content:space-between;padding:4px 0;border-bottom:1px solid var(--border);">
<span style="color:var(--muted2);">${fr.home} vs ${fr.away}</span>
<span style="font-family:var(--font-h);color:var(--primary2);">${fr.homeScore}‚Äî${fr.awayScore}</span>
</div>`;
});
html+=`</div>`;
$('simRanking').innerHTML = html;
}
function resetSimulation() {
$('simSetup')?.classList.add('hidden');
$('simResults')?.classList.add('hidden');
simPlayers=[]; simMatches=[]; simPredictions={}; simGroup=null;
}
let mundialConfig = { campeon:8, sub:6, tercero:3, goleador:5 };
async function openMundialModal() {
openModal('mundialModal');
if (me.isAdmin) $('mundialAdminConfig').classList.remove('hidden');
try {
const cfg = await db.collection('system').doc('mundialConfig').get();
if (cfg.exists) {
mundialConfig = {...mundialConfig, ...cfg.data()};
$('mPtsCampeon').value    = mundialConfig.campeon;
$('mPtsSub').value        = mundialConfig.sub;
$('mPtsTercero').value    = mundialConfig.tercero;
$('mPtsGoleador').value   = mundialConfig.goleador;
}
} catch(e) {}
updateMundialLabels();
const selects = ['mCampeon','mSubcampeon','mTercero'];
selects.forEach(id => {
const sel = $(id);
sel.innerHTML = '<option value="">Selecciona...</option>';
MUNDIAL_TEAMS.forEach(t => sel.innerHTML += `<option value="${t}">${t}</option>`);
});
try {
const myPred = await db.collection('mundialPreds').doc(me.uid).get();
if (myPred.exists) {
const d = myPred.data();
$('mCampeon').value    = d.campeon    || '';
$('mSubcampeon').value = d.subcampeon || '';
$('mTercero').value    = d.tercero    || '';
$('mGoleador').value   = d.goleador   || '';
$('mCampeon').disabled    = true;
$('mSubcampeon').disabled = true;
$('mTercero').disabled    = true;
$('mGoleador').disabled   = true;
$('mundialSaveBtn').classList.add('hidden');
$('mundialSavedMsg').classList.remove('hidden');
}
} catch(e) {}
}
function updateMundialLabels() {
$('mPtsCampeonLabel').textContent  = `Vale ${mundialConfig.campeon} pts si aciertas`;
$('mPtsSubLabel').textContent      = `Vale ${mundialConfig.sub} pts si aciertas`;
$('mPtsTerceroLabel').textContent  = `Vale ${mundialConfig.tercero} pts si aciertas`;
$('mPtsGoleadorLabel').textContent = `Vale ${mundialConfig.goleador} pts si aciertas`;
}
async function saveMundialConfig() {
if (!me.isAdmin) return;
mundialConfig = {
campeon:   +$('mPtsCampeon').value,
sub:       +$('mPtsSub').value,
tercero:   +$('mPtsTercero').value,
goleador:  +$('mPtsGoleador').value,
lockedAt:  firebase.firestore.FieldValue.serverTimestamp()
};
try {
await db.collection('system').doc('mundialConfig').set(mundialConfig);
updateMundialLabels();
toast('‚úÖ Configuraci√≥n guardada y bloqueada','success');
} catch(e) { toast('Error: '+e.message,'error'); }
}
async function saveMundialPreds() {
const campeon    = $('mCampeon').value;
const subcampeon = $('mSubcampeon').value;
const tercero    = $('mTercero').value;
const goleador   = $('mGoleador').value.trim();
if (!campeon)    { toast('Elige el Campe√≥n','error'); return; }
if (!subcampeon) { toast('Elige el Subcampe√≥n','error'); return; }
if (!tercero)    { toast('Elige el Tercer lugar','error'); return; }
if (!goleador)   { toast('Escribe el nombre del Goleador','error'); return; }
if (campeon === subcampeon || campeon === tercero || subcampeon === tercero) {
toast('No puedes repetir selecciones','error'); return;
}
if (!confirm('¬øConfirmas tus predicciones? No podr√°s cambiarlas despu√©s.')) return;
try {
await db.collection('mundialPreds').doc(me.uid).set({
userId: me.uid, username: me.username,
campeon, subcampeon, tercero, goleador,
ptsConfig: {...mundialConfig},
evaluated: false,
savedAt: firebase.firestore.FieldValue.serverTimestamp()
});
['mCampeon','mSubcampeon','mTercero','mGoleador'].forEach(id => $(id).disabled = true);
$('mundialSaveBtn').classList.add('hidden');
$('mundialSavedMsg').classList.remove('hidden');
toast('‚úÖ Predicciones mundiales guardadas','success');
} catch(e) { toast('Error: '+e.message,'error'); }
}
async function evalMundial() {
if (!me.isAdmin) return;
const campeon    = prompt('ü•á Campe√≥n real:');    if (!campeon) return;
const subcampeon = prompt('ü•à Subcampe√≥n real:'); if (!subcampeon) return;
const tercero    = prompt('ü•â Tercer lugar real:');if (!tercero) return;
const goleador   = prompt('‚öΩ Goleador real:');   if (!goleador) return;
if (!confirm(`¬øEvaluar con:
ü•á ${campeon}
ü•à ${subcampeon}
ü•â ${tercero}
‚öΩ ${goleador}?`)) return;
try {
const snap = await db.collection('mundialPreds').where('evaluated','==',false).get();
let count = 0;
for (const doc of snap.docs) {
const p = doc.data();
const cfg = p.ptsConfig || mundialConfig;
let pts = 0;
if (p.campeon    === campeon)    pts += cfg.campeon;
if (p.subcampeon === subcampeon) pts += cfg.sub;
if (p.tercero    === tercero)    pts += cfg.tercero;
if (p.goleador?.toLowerCase() === goleador.toLowerCase()) pts += cfg.goleador;
await doc.ref.update({ evaluated:true, ptsAwarded:pts,
realCampeon:campeon, realSub:subcampeon,
realTercero:tercero, realGoleador:goleador });
if (pts > 0) {
await db.collection('users').doc(p.userId).update({
points: firebase.firestore.FieldValue.increment(pts)
});
}
count++;
}
toast(`‚úÖ ${count} predicciones mundiales evaluadas`,'success');
} catch(e) { toast('Error: '+e.message,'error'); }
}
window.addEventListener('online',  ()=>toast('‚úÖ Conexi√≥n restaurada','success'));
window.addEventListener('offline', ()=>toast('‚ö†Ô∏è Sin conexi√≥n','warning'));
console.log('%c‚öΩ QUINIELA LuAn V3 ‚Äî REESCRITURA TOTAL','color:#9d7dff;font-size:16px;font-weight:bold;');
</script>
</body>
  </html>








